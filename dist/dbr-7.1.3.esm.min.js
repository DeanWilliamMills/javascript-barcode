/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2019, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 7.1.3
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/Products/barcode-recognition-javascript.aspx
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var c=0;return function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.makeIterator=function(b){var c="undefined"!=typeof Symbol&&Symbol.iterator&&b[Symbol.iterator];return c?c.call(b):$jscomp.arrayIterator(b)};
var TaskQueue=function(){var b=function(){this._queue=[];this.isWorking=!1;this.timeout=100};b.prototype.push=function(b,a,d){this._queue.push({task:b,context:a,args:d});this.isWorking||this.next()};b.prototype.unshift=function(b,a,d){this._queue.unshift({task:b,context:a,args:d});this.isWorking||this.next()};b.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var b=this._queue.shift(),a=b.task,d=b.context?b.context:null,k=b.args?b.args:[];setTimeout(function(){a.apply(d,
k)},this.timeout)}};return b}(),dbrEnv={};"undefined"!=typeof self?(dbrEnv._self=self,self.document?dbrEnv._bDom=!0:dbrEnv._bWorker=!0):(dbrEnv._self=global,dbrEnv._bNodejs=!0);
var kUtilDateFormat=function(b,c){var a={"M+":b.getUTCMonth()+1,"d+":b.getUTCDate(),"h+":b.getUTCHours(),"m+":b.getUTCMinutes(),"s+":b.getUTCSeconds(),"q+":Math.floor((b.getUTCMonth()+3)/3),S:b.getUTCMilliseconds()};/(y+)/.test(c)&&(c=c.replace(RegExp.$1,(b.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in a)(new RegExp("("+d+")")).test(c)&&(c=c.replace(RegExp.$1,1==RegExp.$1.length?a[d]:("00"+a[d]).substr((""+a[d]).length)));return c},BarcodeReader=function(){var b=dbrEnv,c=b._self,a=function(e){e=
e||a.productKeys||a.licenseKey||"";if(!("string"==typeof e||"object"==typeof e&&e instanceof String))throw TypeError("'Constructor BarcodeReader(productKeys)': Type of 'productKeys' should be 'String'.");this._productKeys=e;if(!a.isLoaded())throw Error("'Constructor BarcodeReader(productKeys)': Autoload haven't start or you want to call `loadWasm` manually.");b._bDom||(this._instance=new a._BarcodeReaderWasm(e),8==e.length&&this._instance.InitSettingsFromServer(JSON.stringify({key:e,licenseinfo:a._runtimeLicenseResponse.licenseinfo,
bDebug:!!a._bWasmRuntimeLicenseDebug,initTime:kUtilDateFormat(new Date,"yyyyMMddhhmmss")})))};a._jsVersion="7.1.3";a._jsEditVersion="20190729";a.version="loading...(JS "+a._jsVersion+"."+a._jsEditVersion+")";a.isLoaded=function(){return"loaded"==this._loadWasmStatus};a._dbName="dynamsoft-dbr-wasm-"+a._jsVersion;a._DB=void 0;a._licenseUrls=["https://dbrauthorize.dynamsoft.com/api/DbrLicense/WasmGetLicense","https://dbrauthorize.dynamsoft.net/api/DbrLicense/WasmGetLicense"];a.licenseKey=c.__dbrLicenseKey__;
a.productKeys=c.__dbrProductKeys__;a._runtimeLicenseResponse=void 0;var d=b._bDom?c.__dbrWasmCurrentScript__?__dbrWasmCurrentScript__:import.meta.url.substring(0, import.meta.url.lastIndexOf("/")):void 0;a._resourcesPath=d;a._workerName=void 0;a._wasmjsName=void 0;a._wasmName=void 0;a._workerResourcePath=void 0;a._wasmjsResourcePath=void 0;a._wasmResourcePath=void 0;a._isShowRelDecodeTimeInResults=!1;a._bCustomWorker=void 0;a._bWithio=void 0;a._onWasmDownloaded=void 0;a._bLoadWorkerDirectlyFromUrl=void 0;a._onLog=void 0;a._canvasMaxWH=
4096;a._bUseIndexDB=!0;a._bDebuggerInWorker=!1;a._indexPostUrl=0;a.createInstance=function(e){return a.loadWasm().then(function(){var f=new a(e);return b._bDom?f._createWorkerInstance():Promise.resolve(f)})};var k=a._workerCallbackDic={};a._loadWorker=function(){return new Promise(function(e,b){var f=a._workerName||"dbr-"+a._jsVersion+".min.js";if(a._workerResourcePath||a._resourcesPath){var n=a._workerResourcePath||a._resourcesPath;"/"!=n.charAt(n.length-1)&&(n+="/");void 0===a._bLoadWorkerDirectlyFromUrl&&
location&&location.origin&&0==a._resourcesPath.indexOf(location.origin)&&(a._bLoadWorkerDirectlyFromUrl=!0);f=n+f}Promise.resolve().then(function(){return a._bLoadWorkerDirectlyFromUrl?f:fetch(f).then(function(a){return a.blob()}).then(function(a){return URL.createObjectURL(a)})}).then(function(f){var g=a._dbrWorker=new Worker(f);g.onerror=function(e){e="worker error, you should host the page in web service: "+e.message;a._onLog&&a._onLog(e);b(e)};g.onmessage=function(h){h=h.data;switch(h.type){case "log":a._onLog&&
a._onLog(h.message);break;case "load":h.success?(a.version=h.version,a._defaultRuntimeSettings=h._defaultRuntimeSettings,a._onLog&&a._onLog("load dbr worker success"),e()):b(h.exception);a._bLoadWorkerDirectlyFromUrl||URL.revokeObjectURL(f);break;case "task":try{k[h.id](h.body),k[h.id]=void 0}catch(m){throw k[h.id]=void 0,m;}break;default:a._onLog&&a._onLog(h)}};var n=document.createElement("a");n.href=a._resourcesPath||"./";var p=void 0;a._wasmjsResourcePath&&(p=document.createElement("a"),p.href=
a._wasmjsResourcePath||"./",p=p.href);var c=void 0;a._wasmResourcePath&&(c=document.createElement("a"),c.href=a._wasmResourcePath||"./",c=c.href);g.postMessage({type:"loadWorker",_licenseUrls:a._licenseUrls,productKeys:a.productKeys,_resourcesPath:n.href,_wasmjsResourcePath:p,_wasmResourcePath:c,_bUseIndexDB:a._bUseIndexDB,_bDebuggerInWorker:a._bDebuggerInWorker,_bWasmRuntimeLicenseDebug:a._bWasmRuntimeLicenseDebug,origin:location.origin})}).catch(function(a){b(a)})})};a.prototype._createWorkerInstance=
function(){var e=this;return new Promise(function(b,g){var f=Math.random();k[f]=function(f){return f.success?f.instanceID?(e._instanceID=f.instanceID,b(e)):g(a.BarcodeReaderException(a.EnumErrorCode.DBR_NULL_REFERENCE,"Can't create BarcodeReader instance.")):g(f.exception)};a._dbrWorker.postMessage({type:"createInstance",id:f,productKeys:e._productKeys})})};a.prototype.destroy=a.prototype.deleteInstance=function(){var e=this;if(this._instance)this._instance.delete();else if(this._instanceID)return new Promise(function(b,
g){var f=Math.random();k[f]=function(a){return a.success?b():g(a.exception)};a._dbrWorker.postMessage({type:"deleteInstance",id:f,instanceID:e._instanceID})})};a.prototype._decodeBlob=function(a,f){var e=this;if(!(c.Blob&&a instanceof Blob))return Promise.reject("'_decodeBlob(blob, config)': Type of 'blob' should be 'Blob'.");if(b._bDom){var n=function(a){return new Promise(function(e,b){var f=URL.createObjectURL(a),h=new Image;h.dbrObjUrl=f;h.src=f;h.onload=function(){e(h)};h.onerror=function(){b(TypeError("'_decodeBlob(blob, config)': Can't convert the blob to image."))}})},
d;return function(){return c.createImageBitmap?createImageBitmap(a).then(function(a){return d=a},function(){return n(a)}):n(a)}().then(function(a){return e._decodeImage(a,f)}).then(function(a){d&&d.close();return a})}return(new Promise(function(e){var b=new FileReader;b.onload=function(){e(b.result)};b.readAsArrayBuffer(a)})).then(function(a){return e._decodeArrayBuffer(a,f)})};a.prototype._decodeArrayBuffer=function(a,f){return c.arrayBuffer&&a instanceof ArrayBuffer||c.Buffer&&a instanceof Buffer?
b._bDom?this._decodeBlob(new Blob(a),f):this._decodeUint8Array(new Uint8Array(a),f):Promise.reject("'_decodeArrayBuffer(arrayBuffer, config)': Type of 'arrayBuffer' should be 'ArrayBuffer' or 'Buffer'.")};a.prototype._decodeUint8Array=function(e,f){var g=this;if(!(c.Uint8Array&&e instanceof Uint8Array||c.Uint8ClampedArray&&e instanceof Uint8ClampedArray))return Promise.reject("'_decodeBlob(uint8Array, config)': Type of 'uint8Array' should be 'Uint8Array'.");if(b._bDom)return this._decodeBlob(new Blob(e),
f);var n=f?f.templateName||"":"";return new Promise(function(b){if(a._isShowRelDecodeTimeInResults){var f=(new Date).getTime(),c=g._instance.DecodeFileInMemory(e,n);f=(new Date).getTime()-f;c=l(c);c._decodeTime=f;return b(c)}return b(l(g._instance.DecodeFileInMemory(e,n)))})};a.prototype._decodeImage=function(e,b){var f=this;b=b||{};return(new Promise(function(a){if(!(c.HTMLImageElement&&e instanceof HTMLImageElement||c.ImageBitmap&&e instanceof ImageBitmap))throw TypeError("'_decodeImage(image, config)': Type of 'image' should be 'HTMLImageElement or ImageBitmap'.");
if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";a()})).then(function(){var g=e.naturalWidth||e.width,c=e.naturalHeight||e.height,d=document.createElement("canvas"),u=void 0,p=Math.max(g,c);p>a._canvasMaxWH&&(p=a._canvasMaxWH/p,g=Math.round(g*p),c=Math.round(c*p));p=d.getContext("2d");switch(b._videoOrientation){case 3:d.width=g;d.height=c;p.setTransform(-1,0,0,-1,g,c);break;case 6:d.width=c;d.height=g;p.setTransform(0,1,-1,0,c,0);break;case 8:d.width=c;d.height=g;p.setTransform(0,-1,1,0,
0,g);break;default:d.width=g,d.height=c}p.drawImage(e,0,0,g,c);if(b.sx||b.sy||b.sWidth||b.sHeight||b.dWidth||b.dHeight){g=c=0;p=d.width;var k=d.height,h=d.width,m=d.height;void 0!=b.sx&&(c=b.sx);void 0!=b.sy&&(g=b.sy);void 0!=b.sWidth&&(p=b.sWidth);void 0!=b.sHeight&&(k=b.sHeight);void 0!=b.dWidth&&(h=b.dWidth);void 0!=b.dHeight&&(m=b.dHeight);0<c&&1>=c&&(c=Math.round(c*d.width));0<g&&1>=g&&(g=Math.round(g*d.height));1>=p&&(p=Math.round(p*d.width));1>=k&&(k=Math.round(k*d.height));1>=h&&(h=Math.round(h*
d.width));1>=m&&(m=Math.round(m*d.height));u=document.createElement("canvas");u.getContext("2d").drawImage(d,c,g,p,k,0,0,h,m)}e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl);return f._decodeCanvas(u||d,b).then(function(a){if(b.bAddOriVideoCanvasToResult)for(var e=$jscomp.makeIterator(a),h=e.next();!h.done;h=e.next())h.value.oriVideoCanvas=d;if(b.bAddSearchRegionCanvasToResult)for(e=$jscomp.makeIterator(a),h=e.next();!h.done;h=e.next())h.value.searchRegionCanvas=u;return a})})};a.prototype._decodeCanvas=
function(b,f){var e=this;return(new Promise(function(a){if(!(c.HTMLCanvasElement&&b instanceof HTMLCanvasElement))throw TypeError("'_decodeCanvas(canvas, config)': Type of 'canvas' should be 'HTMLCanvasElement'.");if(b.crossOrigin&&"anonymous"!=b.crossOrigin)throw"cors";var e=b.getContext("2d").getImageData(0,0,b.width,b.height).data;a(e)})).then(function(g){return e._decodeRawImageUint8Array(g,b.width,b.height,4*b.width,a.EnumImagePixelFormat.IPF_ARGB_8888,f)})};a.prototype._decodeVideo=a.prototype.decodeVideo=
function(a,b){var e=this,f,d;b=b||{};return(new Promise(function(e){if(!(c.HTMLVideoElement&&a instanceof HTMLVideoElement))throw TypeError("'_decodeVideo(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(a.crossOrigin&&"anonymous"!=a.crossOrigin)throw"cors";var g=0,p=0,n=a.videoWidth,h=a.videoHeight,m=a.videoWidth,q=a.videoHeight;void 0!=b.sx&&(g=b.sx);void 0!=b.sy&&(p=b.sy);void 0!=b.sWidth&&(n=b.sWidth);void 0!=b.sHeight&&(h=b.sHeight);void 0!=b.dWidth&&(m=b.dWidth);void 0!=
b.dHeight&&(q=b.dHeight);0<g&&1>=g&&(g=Math.round(g*a.videoWidth));0<p&&1>=p&&(p=Math.round(p*a.videoHeight));1>=n&&(n=Math.round(n*a.videoWidth));1>=h&&(h=Math.round(h*a.videoHeight));1>=m&&(m=Math.round(m*a.videoWidth));1>=q&&(q=Math.round(q*a.videoHeight));b.bAddOriVideoCanvasToResult&&(f=document.createElement("canvas"),f.width=a.videoWidth,f.height=a.videoHeight,f.getContext("2d").drawImage(a,0,0));d=document.createElement("canvas");d.width=m;d.height=q;var k=d.getContext("2d");0==g&&0==p&&a.videoWidth==
n&&a.videoHeight==h&&a.videoWidth==m&&a.videoHeight==q?k.drawImage(f||a,0,0):k.drawImage(f||a,g,p,n,h,0,0,m,q);e()})).then(function(){var a=JSON.parse(JSON.stringify(b));a.sx=void 0;a.sy=void 0;a.sWidth=void 0;a.sHeight=void 0;a.dWidth=void 0;a.dHeight=void 0;return e._decodeCanvas(d,b)}).then(function(a){if(b.bAddOriVideoCanvasToResult)for(var e=$jscomp.makeIterator(a),g=e.next();!g.done;g=e.next())g.value.oriVideoCanvas=f;if(b.bAddSearchRegionCanvasToResult)for(e=$jscomp.makeIterator(a),g=e.next();!g.done;g=
e.next())g.value.searchRegionCanvas=d;return a})};a.prototype._decodeBase64=a.prototype.decodeBase64String=function(a,f){var e=this;if(!("string"==typeof a||"object"==typeof a&&a instanceof String))return Promise.reject("'decodeBase64(base64Str, config)': Type of 'base64Str' should be 'String'.");"data:image/"==a.substring(0,11)&&(a=a.substring(a.indexOf(",")+1));return new Promise(function(g){if(b._bNodejs)g(e._decodeArrayBuffer(Buffer.from(a,"base64"),f));else{for(var d=atob(a),c=d.length,n=new Uint8Array(c);c--;)n[c]=
d.charCodeAt(c);b._bDom?g(e._decodeBlob(new Blob([n]),f)):g(e._decodeUint8Array(n,f))}})};a.prototype._decodeUrl=function(a,f){var e=this;return new Promise(function(g,d){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeUrl(url, config)': Type of 'url' should be 'String'.");if(b._bNodejs)(a.startsWith("https")?require("https"):require("http")).get(a,function(a){if(200==a.statusCode){var b=[];a.on("data",function(a){b.push(a)}).on("end",function(){g(e._decodeArrayBuffer(Buffer.concat(b),
f))})}else d("http get fail, statusCode: "+a.statusCode)});else{var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType=b._bDom?"blob":"arraybuffer";c.send();c.onloadend=function(){b._bDom?g(e._decodeBlob(c.response,f)):g(e._decodeArrayBuffer(c.response,f))};c.onerror=function(){d(c.error)}}})};a.prototype._decodeFilePath=function(a,b){var e=this;return new Promise(function(g,c){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeFilePath(path, config)': Type of 'path' should be 'String'.");
require("fs").readFile(a,function(a,f){a?c(a):g(e._decodeArrayBuffer(f,b))})})};a.prototype._decodeRawImageBlob=function(a,b,g,d,k,l){var e=this;return(new Promise(function(b,e){if(!(c.Blob&&a instanceof Blob))throw TypeError("'_decodeRawImageBlob(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'Blob'.");var h=new FileReader;h.readAsArrayBuffer(a);h.onload=function(){b(h.result)};h.onerror=function(){e(h.error)}})).then(function(a){return e._decodeRawImageUint8Array(new Uint8Array(a),
b,g,d,k,l)})};a.prototype._decodeRawImageArrayBuffer=function(a,b,g,d,k,l){var e=this;return(new Promise(function(b){if(!(c.ArrayBuffer&&a instanceof ArrayBuffer))throw TypeError("'_decodeRawImageArrayBuffer(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'ArrayBuffer'.");b()})).then(function(){return e._decodeRawImageUint8Array(new Uint8Array(a),b,g,d,k,l)})};a.prototype._decodeRawImageUint8Array=function(b,d,g,n,x,t){var e=this;return(new Promise(function(a){if(!(c.Uint8Array&&
b instanceof Uint8Array||c.Uint8ClampedArray&&b instanceof Uint8ClampedArray))throw TypeError("'_decodeRawImageUint8Array(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'Uint8Array'.");a()})).then(function(){var c=t?t.templateName||"":"";if(e._instance){var f=a._isShowRelDecodeTimeInResults?(new Date).getTime():void 0;try{var h=e._instance.DecodeBuffer(b,d,g,n,x,c)}catch(y){return setTimeout(function(){console.error("wasm error!");throw y;},0),Promise.reject(y)}c=
a._isShowRelDecodeTimeInResults?(new Date).getTime()-f:void 0;h=l(h);a._isShowRelDecodeTimeInResults&&(h._decodeTime=c);if(t.videoWidth&&t.videoHeight){c=1;var m=f=0;c=d/g>=t.videoWidth/t.videoHeight?t.videoHeight/g:t.videoWidth/d;f=(d*c-t.videoWidth)/2;m=(g*c-t.videoHeight)/2;for(var q=0;q<h.length;++q){var r=h[q].LocalizationResult;r.X1=r.X1*c-f;r.X2=r.X2*c-f;r.X3=r.X3*c-f;r.X4=r.X4*c-f;r.Y1=r.Y1*c-m;r.Y2=r.Y2*c-m;r.Y3=r.Y3*c-m;r.Y4=r.Y4*c-m}}return Promise.resolve(h)}h=e._instanceID?Promise.resolve():
e._createWorkerInstance();return h.then(function(){return null===e._runtimeSettings?new Promise(function(b,h){var c=Math.random();k[c]=function(a){return a.success?(e._runtimeSettings=void 0,b()):h(a.exception)};a._dbrWorker.postMessage({type:"resetRuntimeSettings",id:c,instanceID:e._instanceID})}):Promise.resolve()}).then(function(){return new Promise(function(h,c){var f=Math.random();k[f]=function(a){return a.success?h(a.results):c(a.exception)};a._dbrWorker.postMessage({type:"decodeRawImageUint8Array",
id:f,instanceID:e._instanceID,body:{buffer:b,width:d,height:g,stride:n,enumImagePixelFormat:x,config:t},_isShowRelDecodeTimeInResults:a._isShowRelDecodeTimeInResults})})})})};a.prototype.decode=a.prototype.decodeFileInMemory=function(a,d){return c.Blob&&a instanceof Blob?this._decodeBlob(a,d):c.ArrayBuffer&&a instanceof ArrayBuffer||c.Buffer&&a instanceof Buffer?this._decodeArrayBuffer(a,d):c.Uint8Array&&a instanceof Uint8Array||c.Uint8ClampedArray&&a instanceof Uint8ClampedArray?this._decodeUint8Array(a,
d):c.HTMLImageElement&&a instanceof HTMLImageElement||c.ImageBitmap&&a instanceof ImageBitmap?this._decodeImage(a,d):c.HTMLCanvasElement&&a instanceof HTMLCanvasElement?this._decodeCanvas(a,d):c.HTMLVideoElement&&a instanceof HTMLVideoElement?this._decodeVideo(a,d):"string"==typeof a||a instanceof String?"data:image/"==a.substring(0,11)?this._decodeBase64(a,d):b._bNodejs?"http"==a.substring(0,4)?this._decodeUrl(a,d):this._decodeFilePath(a,d):this._decodeUrl(a,d):Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))};
a.prototype._decodeRawImage=a.prototype.decodeBuffer=function(a,b,d,n,k,l){return c.Blob&&a instanceof Blob?this._decodeRawImageBlob(a,b,d,n,k,l):c.ArrayBuffer&&a instanceof ArrayBuffer?this._decodeRawImageArrayBuffer(a,b,d,n,k,l):c.Uint8Array&&a instanceof Uint8Array||c.Uint8ClampedArray&&a instanceof Uint8ClampedArray?this._decodeRawImageUint8Array(a,b,d,n,k,l):Promise.reject(TypeError("'_decodeRawImage(source, width, height, stride, enumImagePixelFormat, config)': Type of 'source' should be 'Blob', 'ArrayBuffer' or 'Uint8Array'."))};
var l=a._handleRetJsonString=function(e){e="string"==typeof e||"object"==typeof e&&e instanceof String?JSON.parse(e):e;var c=a.EnumErrorCode;switch(e.exception){case c.DBR_SUCCESS:case c.DBR_LICENSE_INVALID:case c.DBR_LICENSE_EXPIRED:case c.DBR_1D_LICENSE_INVALID:case c.DBR_QR_LICENSE_INVALID:case c.DBR_PDF417_LICENSE_INVALID:case c.DBR_DATAMATRIX_LICENSE_INVALID:case c.DBR_DBRERR_AZTEC_LICENSE_INVALID:case c.DBR_RECOGNITION_TIMEOUT:if(e.textResult)for(c=0;c<e.textResult.length;++c){var d=e.textResult[c];
try{if(b._bNodejs)d.BarcodeText=Buffer.from(d.BarcodeBytes).toString();else{for(var n=d.BarcodeBytes,k="",l=0;l<n.length;l++)k+=String.fromCharCode(n[l]);try{d.BarcodeText=decodeURIComponent(escape(k))}catch(u){d.BarcodeText=k}}}catch(u){d.BarcodeText=""}}return e.textResult||e.settings||e.outputSettings||e;default:throw a.BarcodeReaderException(e.exception,e.description);}};a.prototype.getAllParameterTemplateNames=function(){return l(this._instance.GetAllParameterTemplateNames())};a.prototype.getRuntimeSettings=
function(){return this._instance?l(this._instance.GetRuntimeSettings()):this._runtimeSettings?JSON.parse(this._runtimeSettings):JSON.parse(a._defaultRuntimeSettings)};a.prototype.updateRuntimeSettings=function(b){var c=this;if("string"==typeof b||"object"==typeof b&&b instanceof String)var d=b;else if("object"==typeof b)d=JSON.stringify(b);else throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");if(this._instance)try{return l(this._instance.UpdateRuntimeSettings(d)),
Promise.resolve()}catch(n){return Promise.reject(n)}else return this._runtimeSettings=d,Promise.resolve().then(function(){return c._instanceID?Promise.resolve():c._createWorkerInstance()}).then(function(){return new Promise(function(b,e){var g=Math.random();k[g]=function(a){return a.success?b():e(a.exception)};a._dbrWorker.postMessage({type:"updateRuntimeSettings",id:g,instanceID:c._instanceID,body:{settings:d}})})}).catch(function(a){return Promise.reject(a)})};a.prototype.resetRuntimeSettings=function(){this._instance?
l(this._instance.ResetRuntimeSettings()):this._runtimeSettings=null};a.prototype.outputSettingsToString=function(a){return l(this._instance.OutputSettingsToString(a||""))};a.prototype.initRuntimeSettingsWithString=function(a,b){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))if("object"==typeof a)a=JSON.stringify(a);else throw TypeError("'initRuntimeSettingstWithString(template, enumComflictMode)': Type of 'template' should be 'String' or 'PlainObject'.");l(this._instance.InitRuntimeSettingstWithString(a,
b?b:2))};a.EnumBarcodeFormat={All:503318527,OneD:2047,CODE_39:1,CODE_128:2,CODE_93:4,CODABAR:8,ITF:16,EAN_13:32,EAN_8:64,UPC_A:128,UPC_E:256,INDUSTRIAL_25:512,CODE_39_EXTENDED:1024,PDF417:33554432,QR_CODE:67108864,DATAMATRIX:134217728,AZTEC:268435456};a.EnumErrorCode={DBR_SYSTEM_EXCEPTION:1,DBR_SUCCESS:0,DBR_UNKNOWN:-1E4,DBR_NO_MEMORY:-10001,DBR_NULL_REFERENCE:-10002,DBR_LICENSE_INVALID:-10003,DBR_LICENSE_EXPIRED:-10004,DBR_FILE_NOT_FOUND:-10005,DBR_FILETYPE_NOT_SUPPORTED:-10006,DBR_BPP_NOT_SUPPORTED:-10007,
DBR_INDEX_INVALID:-10008,DBR_BARCODE_FORMAT_INVALID:-10009,DBR_CUSTOM_REGION_INVALID:-10010,DBR_MAX_BARCODE_NUMBER_INVALID:-10011,DBR_IMAGE_READ_FAILED:-10012,DBR_TIFF_READ_FAILED:-10013,DBR_QR_LICENSE_INVALID:-10016,DBR_1D_LICENSE_INVALID:-10017,DBR_DIB_BUFFER_INVALID:-10018,DBR_PDF417_LICENSE_INVALID:-10019,DBR_DATAMATRIX_LICENSE_INVALID:-10020,DBR_PDF_READ_FAILED:-10021,DBR_PDF_DLL_MISSING:-10022,DBR_PAGE_NUMBER_INVALID:-10023,DBR_CUSTOM_SIZE_INVALID:-10024,DBR_CUSTOM_MODULESIZE_INVALID:-10025,
DBR_RECOGNITION_TIMEOUT:-10026,DBR_JSON_PARSE_FAILED:-10030,DBR_JSON_TYPE_INVALID:-10031,DBR_JSON_KEY_INVALID:-10032,DBR_JSON_VALUE_INVALID:-10033,DBR_JSON_NAME_KEY_MISSING:-10034,DBR_JSON_NAME_VALUE_DUPLICATED:-10035,DBR_TEMPLATE_NAME_INVALID:-10036,DBR_JSON_NAME_REFERENCE_INVALID:-10037,DBR_PARAMETER_VALUE_INVALID:-10038,DBR_DOMAIN_NOT_MATCHED:-10039,DBR_RESERVEDINFO_NOT_MATCHED:-10040,DBR_DBRERR_AZTEC_LICENSE_INVALID:-10041};a.EnumImagePixelFormat={IPF_Binary:0,IPF_BinaryInverted:1,IPF_GrayScaled:2,
IPF_NV21:3,IPF_RGB_565:4,IPF_RGB_555:5,IPF_RGB_888:6,IPF_ARGB_8888:7,IPF_RGB_161616:8,IPF_ARGB_16161616:9};a.EnumResultType={EDT_StandardText:0,EDT_RawText:1,EDT_CandidateText:2,EDT_PartialText:3};a.EnumTerminatePhase={TP_REGION_PREDETECTED:1,TP_IMAGE_PREPROCESSED:2,TP_IMAGE_BINARIZED:4,TP_BARCODE_LOCALIZED:8,TP_BARCODE_TYPE_DETERMINED:16,TP_BARCODE_RECOGNIZED:32};a.EnumConflictMode={ECM_Ignore:1,ECM_Overwrite:2};a.EnumLocalizationMode={LM_SKIP:0,LM_AUTO:1,LM_CONNECTED_BLOCKS:2,LM_STATISTICS:4,LM_LINES:8,
LM_SCAN_DIRECTLY:16,LM_STATISTICS_MARKS:32};a.BarcodeReaderException=function(){return function(b,c){var d=a.EnumErrorCode.DBR_UNKNOWN;"number"==typeof b?(d=b,b=Error(c)):b=Error(b);b.code=d;return b}}();return a}(),Dynamsoft=BarcodeReader;BarcodeReader.BarcodeReader=BarcodeReader;
!dbrEnv._bWorker||BarcodeReader._bCustomWorker||dbrEnv._self.onmessage||function(){var b=dbrEnv._self,c=BarcodeReader;c._onLog=c._onLog||function(a){if(b.onmessage!=c._onWorkerMessage)c._onLog=void 0;else{var d=void 0;if(void 0===a)d="undefined";else{try{d=JSON.stringify(a,function(){var a=[],b=[];return function(c,d){if("object"===typeof d&&null!==d){var e=a.indexOf(d);if(-1!==e)return"[Circular "+b[e]+"]";a.push(d);b.push(c||"root")}return d}}())}catch(l){}if(void 0===d||"{}"===d)d=a.toString()}try{postMessage({type:"log",
message:d})}catch(l){b.console&&console.error(message)}}};c._onLog("have detected in worker: "+c.version);var a={};b.onmessage=c._onWorkerMessage=function(d){d=d.data;switch(d.type){case "loadWorker":(function(){c._licenseUrls=d._licenseUrls;c.productKeys=d.productKeys;c._resourcesPath=d._resourcesPath;c._wasmjsResourcePath=d._wasmjsResourcePath;c._wasmResourcePath=d._wasmResourcePath;c._bUseIndexDB=d._bUseIndexDB;if(d._bDebuggerInWorker)debugger;c._bWasmRuntimeLicenseDebug=d._bWasmRuntimeLicenseDebug;
b.__dbrOrigin=d.origin;c.loadWasm().then(function(){postMessage({type:"load",success:!0,version:c.version,_defaultRuntimeSettings:c._defaultRuntimeSettings})},function(a){postMessage({type:"load",success:!1,exception:a.message||a})})})();break;case "createInstance":(function(){try{var b=Math.random();a[b]=new c(d.productKeys);postMessage({type:"task",id:d.id,body:{success:!0,instanceID:b}})}catch(l){postMessage({type:"task",id:d.id,body:{success:!1,exception:l.message||l}})}})();break;case "deleteInstance":try{a[d.instanceID].deleteInstance(),
a[d.instanceID]=void 0,postMessage({type:"task",id:d.id,body:{success:!0}})}catch(k){postMessage({type:"task",id:d.id,body:{success:!1,exception:k.message||k}})}break;case "decodeRawImageUint8Array":(function(){try{c._isShowRelDecodeTimeInResults=d._isShowRelDecodeTimeInResults;var b=d.body;a[d.instanceID]._decodeRawImageUint8Array(b.buffer,b.width,b.height,b.stride,b.enumImagePixelFormat,b.config).then(function(a){postMessage({type:"task",id:d.id,body:{success:!0,results:a}})}).catch(function(a){postMessage({type:"task",
id:d.id,body:{success:!1,exception:a.message||a}})})}catch(l){postMessage({type:"task",id:d.id,body:{success:!1,exception:l.message||l}})}})();break;case "getRuntimeSettings":(function(){try{var b=a[d.instanceID].getRuntimeSettings();postMessage({type:"task",id:d.id,body:{success:!0,settings:b}})}catch(l){postMessage({type:"task",id:d.id,body:{success:!1,exception:l.message||l}})}})();break;case "updateRuntimeSettings":try{a[d.instanceID].updateRuntimeSettings(d.body.settings),postMessage({type:"task",
id:d.id,body:{success:!0}})}catch(k){postMessage({type:"task",id:d.id,body:{success:!1,exception:k.message||k}})}break;case "resetRuntimeSettings":try{a[d.instanceID].resetRuntimeSettings(),postMessage({type:"task",id:d.id,body:{success:!0}})}catch(k){postMessage({type:"task",id:d.id,body:{success:!1,exception:k.message||k}})}break;case "clearCache":try{c.clearCache(),postMessage({type:"task",id:d.id,body:{success:!0}})}catch(k){postMessage({type:"task",id:d.id,body:{success:!1,exception:k.message||
k}})}break;default:postMessage({type:"task",id:d.id,body:{success:!1,exception:"No such task."}})}}}();
(function(){var b=dbrEnv,c=b._self,a=BarcodeReader;a.loadWasm=function(){return new Promise(function(e,g){if("loaded"==a._loadWasmStatus)return e();a._loadWasmTaskQueue.push(function(f){if("loaded"==a._loadWasmStatus)return a._loadWasmTaskQueue.next(),e();if(f)return a._loadWasmTaskQueue.next(),g(a._loadWasmStatus);a._loadWasmStatus="loading";return(new Promise(function(e,g){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm hasn't finish loading.");};
if(!c.WebAssembly||"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))throw Error("'Constructor BarcodeReader(productKeys)': The browser doesn't support Webassembly.");if(b._bDom)return a._loadWorker().then(function(){return e()},function(b){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm load failed. ex: "+(b.message||b));};return g(b)});var f={locateFile:function(){var c=
a._wasmName;if(a._wasmResourcePath||a._resourcesPath){var d=a._wasmResourcePath||a._resourcesPath;"/"!=d.charAt(d.length-1)&&(d+="/");c=d+c}else b._bNodejs&&(c=require("path").join(__dirname,c));return c},onRuntimeInitialized:function(){a._BarcodeReaderWasm=f.BarcodeReaderWasm;var c=new f.BarcodeReaderWasm("");a.version=c.GetVersion()+"(JS "+a._jsVersion+"."+a._jsEditVersion+")";a._defaultRuntimeSettings=JSON.stringify(a._handleRetJsonString(c.GetRuntimeSettings()));c.delete();a._onLog&&a._onLog("load dbr wasm success, version: "+
a.version);b._bNodejs?e():k.then(function(){e()},function(a){g(a)})}};f.onExit=f.onAbort=function(b){a._onLog&&a._onLog(b);a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm load failed. Error: "+(b.message||b));};g(b)};f.print=function(b){a._onLog&&a._onLog(b)};if("undefined"==typeof _dbrLoadWasm){void 0==a._bWithio&&(a._bWithio=b._bNodejs||b._bWorker&&(a._bCustomWorker||c.onmessage!=a._onWorkerMessage));a._wasmjsName=a._wasmjsName||"dbr-"+a._jsVersion+
".wasm"+(a._bWithio?".withio":"")+".min.js";a._wasmName=a._wasmName||"dbr-"+a._jsVersion+(a._bWithio?".withio":"")+".wasm";var p=a._wasmjsName;if(a._wasmjsResourcePath||a._resourcesPath){var n=a._wasmjsResourcePath||a._resourcesPath;"/"!=n.charAt(n.length-1)&&(n+="/");p=n+p}else b._bNodejs&&(p=require("path").join(__dirname,p));b._bWorker?importScripts(p):_dbrLoadWasm=require(p)}_dbrLoadWasm(f,d,a)})).then(function(){a._loadWasmStatus="loaded";a._loadWasmTaskQueue.next();e()}).catch(function(b){a._loadWasmStatus=
b;a._loadWasmTaskQueue.next();g(b)})},null,["loading"==a._loadWasmStatus])})};a._loadWasmTaskQueue=function(){var a=new TaskQueue;a.timeout=0;return a}();a._openDb=function(){var a=this;return new Promise(function(b,c){var d=function(){g.result.createObjectStore("info");g.result.createObjectStore("wasm");g.result.createObjectStore("license");g.result.createObjectStore("consume")},e="open db ["+a._dbName+"] fail",g=indexedDB.open(a._dbName,1);g.onupgradeneeded=d;g.onsuccess=function(){a._DB=g.result;
b(g.result)};g.onerror=function(){var f=g.error.message||g.error;-1!=f.indexOf("version")?(g=indexedDB.deleteDatabase(a._dbName),g.onsuccess=function(){var g=indexedDB.open(a._dbName,1);g.onupgradeneeded=d;g.onsuccess=function(){a._DB=g.result;b(g.result)};g.onerror=function(){c(e)}},g.onerror=function(){c(e)}):c(e+": "+f)}})};a._lookupInDatabase=function(a,b,c){return new Promise(function(d,e){var g=a.transaction([b]).objectStore(b),f=c?g.get(c):g.getAll();f.onsuccess=function(){f.result?d(f.result):
e(c+" was not found in "+b)}})};a._storeInDatabase=function(a,b,c,d){return new Promise(function(e,g){var f=a.transaction([b],"readwrite").objectStore(b).put(d,c);f.onerror=function(){g("Failed to store "+c+" in indexDB: "+(f.error.message||f.error))};f.onsuccess=function(){e("Successfully stored "+c+" in "+b)}})};a._deleteInDatabase=function(a,b,c){return new Promise(function(d,e){var g=a.transaction([b],"readwrite").objectStore(b),f=c?g.delete(c):g.clear();f.onerror=function(){e("Failed to delete "+
c+" in indexDB: "+(f.error.message||f.error))};f.onsuccess=function(){d("Successfully delete "+c+" in "+b)}})};var d=function(c,d,e){a._onLog&&a._onLog("start handle dbr wasm, version: "+c);var g=(new Date).getTime();if(b._bNodejs)return new Promise(function(b,c){require("fs").readFile(d,function(d,h){if(d)return c(d);var f=(new Date).getTime();b(WebAssembly.instantiate(h,e).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-f));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+
((new Date).getTime()-g));return Promise.resolve(b)}))})});var f=function(a){return new Promise(function(b,c){var d=a.transaction(["info"]).objectStore("info").get("bSupportStoreModuleInDb"),e=function(){var d=a.transaction(["info"],"readwrite").objectStore("info"),e=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,127,3,2,1,0,7,6,1,2,95,97,0,0,10,6,1,4,0,65,1,11]);try{var h=d.put(new WebAssembly.Module(e.buffer),"testStoreModule");h.onsuccess=function(){d.put(!0,"bSupportStoreModuleInDb").onsuccess=
function(){b("set bSupportStoreModuleInDb = true success")}};h.onerror=function(){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+(h.error.message||h.error))}}catch(v){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+(v.message||v))}};d.onsuccess=function(){d.result?b("bSupportStoreModuleInDb == true"):e()}})};return(a._bUseIndexDB?a._openDb():Promise.reject("bUseIndexDB false")).then(function(b){a._onLog&&a._onLog("open db success");
k=l();return f(b).then(function(b){a._onLog&&a._onLog(b);return Promise.resolve(!0)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.resolve(!1)}).then(function(c){var f=(new Date).getTime();return a._lookupInDatabase(b,"wasm",a._wasmName).then(function(d){if(d instanceof WebAssembly.Module){a._onLog&&a._onLog("get a wasm module from db, timecost:"+((new Date).getTime()-f));var h=(new Date).getTime();return WebAssembly.instantiate(d,e).then(function(b){a._onLog&&a._onLog("build instance from module timecost: "+
((new Date).getTime()-h));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-g));return Promise.resolve({module:d,instance:b})})}a._onLog&&a._onLog("get a wasm binary from db, timecost:"+((new Date).getTime()-f));var q=(new Date).getTime();return WebAssembly.instantiate(d,e).then(function(d){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-q));if(c){var e=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,d.module).then(function(b){a._onLog&&
a._onLog(b+", timecost: "+((new Date).getTime()-e));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-g));return Promise.resolve(d)})}a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-g));return Promise.resolve(d)})},function(h){a._onLog&&a._onLog(h.message||h);a._onLog&&a._onLog("downloading...");var f=(new Date).getTime();return c?WebAssembly.instantiateStreaming(fetch(d),e).then(function(c){a._onWasmDownloaded&&a._onWasmDownloaded();
a._onLog&&a._onLog("download with build timecost: "+((new Date).getTime()-f));var d=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-d));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-g));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}):fetch(d).then(function(a){if(a.ok)return a.arrayBuffer();
throw Error("Network error during fetch wasm.");}).then(function(c){a._onLog&&a._onLog("download timecost: "+((new Date).getTime()-f));a._onWasmDownloaded&&a._onWasmDownloaded();var d=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-d));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}).then(function(b){var c=(new Date).getTime();
return WebAssembly.instantiate(b,e).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-c));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-g));return Promise.resolve(b)})})})})},function(b){a._onLog&&a._onLog(b.message||b);k=l();return WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(fetch(d),e).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+
((new Date).getTime()-g));return Promise.resolve(b)}):fetch(d).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();return WebAssembly.instantiate(b,e).then(function(b){a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-g));return Promise.resolve(b)})})})},k,l=function(){var b=a.productKeys,d=(new Date).getTime();if(!b||8!=b.length)return Promise.resolve(!1);var e=
null,k=!1;return a._lookupInDatabase(a._DB,"license",b).then(function(a){e=a;k=e["next-expire-time"]<d},function(){k=!0}).then(function(){a._onLog&&a._onLog("licenseResponseFromDB:");a._onLog&&a._onLog(e);a._onLog&&a._onLog("bNeedGetFromServer: "+k);if(k){var c=0,g=function(){return fetch(a._licenseUrls[c]+(e?"Cache":"")+"?key="+b+"&version=1"+(e?"&uuid="+e.uuid:"")).then(function(a){if(a.ok)return a.text();throw Error("Network Error: fetch licenseinfo.");}).catch(function(b){if(++c<a._licenseUrls.length)return g();
throw b;})};return g().then(function(c){c=JSON.parse(atob(c));a._onLog&&a._onLog("licenseResponseFromServer:");a._onLog&&a._onLog(c);if("ok"==c.status)return a._runtimeLicenseResponse=c,c["next-expire-time"]=d+1E3*c["min-expire-during"],c["max-expire-time"]=d+1E3*c["max-expire-during"],a._storeInDatabase(a._DB,"license",b,c).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+(b.message||b))});if("error"==c.status)throw Error(c.message);if("exceeded"==c.status)throw Error("Authorized Scan Count Reached.");
throw Error("Unknow Response: fetch licenseinfo.");}).catch(function(c){a._onLog&&a._onLog(c.message||c);if(e&&e["max-expire-time"]>d)return e["next-expire-time"]=d+1E3*e["check-interval-after-expire"],a._runtimeLicenseResponse=e,a._storeInDatabase(a._DB,"license",b,e).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+(b.message||b))});throw Error("Can't get valid licenseinfo from runtimekey. Message: "+c.message);})}return a._runtimeLicenseResponse=e}).then(function(){return a._lookupInDatabase(a._DB,
"consume").then(function(b){b.length&&(a._deleteInDatabase(a._DB,"consume"),c._dbrConsume(b))},function(){})})};a.clearCache=function(){return new Promise(function(c,d){if(b._bDom){var e=Math.random();a._workerCallbackDic[e]=function(a){return a.success?c():d(a.exception)};a._dbrWorker.postMessage({type:"clearCache",id:e})}else b._bWorker&&a._deleteInDatabase(a._DB,"wasm").then(function(){return a._deleteInDatabase(a._DB,"license")}).then(function(){return a._deleteInDatabase(a._DB,"info")}).then(function(){c()},
function(a){d(a)})})};var e=!0;c._dbrConsume=function(b){a._onLog&&a._onLog(b);var c=b instanceof Array?b:[b],d=function(){for(var b=0;b<c.length;++b)a._storeInDatabase(a._DB,"consume",Math.random().toString(),c[b]).catch(function(b){a._onLog&&a._onLog(b)})};if(e){e=!1;var f=a._runtimeLicenseResponse["post-urls"],k=[];for(b=0;b<c.length;++b)k.push(encodeURIComponent(c[b]));var l=function(){return fetch(f[a._indexPostUrl],{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",body:"data="+
JSON.stringify(k),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){if(!a.ok)throw Error("consume status: "+a.status);}).catch(function(b){a._onLog&&a._onLog(""+(b.message||b));if(++a._indexPostUrl<f.length)return l();a._indexPostUrl=0;d()})};return l()}d()}})();
if(dbrEnv._bDom){var BR=BarcodeReader,self$25=dbrEnv._self;BR.Scanner=function(b){b=b||{};var c;(c=b.UIElement||b.htmlElement)||(c=document.createElement("div"),c.style.width="100%",c.style.minWidth="100px",c.style.height="100%",c.style.minHeight="100px",c.style.left="0",c.style.top="0",c.style.background="#eee",c.style.display="none",c.innerHTML='<p style="width:100%;height:32px;line-height:32px;position:absolute;margin:auto 0;top:0;bottom:0;text-align:center;">loading</p><video class="dbrScanner-video" playsinline="true" style="width:100%;height:100%;position:absolute;left:0;top:0;"></video><canvas class="dbrScanner-cvs-draw-area" style="width:100%;height:100%;position:absolute;left:0;top:0;"></canvas><select class="dbrScanner-sel-camera" style="position:absolute;left:0;top:0;"></select><select class="dbrScanner-sel-resolution" style="position:absolute;left:0;top:20px;"></select><button class="dbrScanner-btn-close" style="position:absolute;right:0;top:0;"><svg width="16" height="16" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button>');
this.UIElement=c;this.videoSettings=b.videoSettings||{video:{}};c=this.videoSettings.video;c.width||c.height||(c.width={ideal:1280},c.height={ideal:720});c.deviceId||c.facingMode||(c.facingMode={ideal:"environment"});this.intervalTime=b.intervalTime;void 0==this.intervalTime&&(this.intervalTime=100);this.runtimeSettings=b.runtimeSettings;this.searchRegion=b.searchRegion||{sx:void 0,sy:void 0,sWidth:void 0,sHeight:void 0,dWidth:void 0,dHeight:void 0};this.bAddOriVideoCanvasToResult=b.bAddOriVideoCanvasToResult;
this.bAddSearchRegionCanvasToResult=b.bAddSearchRegionCanvasToResult;this.onFrameRead=b.onFrameRead;this.duplicateForgetTime=b.duplicateForgetTime;void 0==this.duplicateForgetTime&&(this.duplicateForgetTime=3E3);this.onUnduplicatedRead=b.onUnduplicatedRead||b.onNewCodeRead;this.barcodeReader=null;this._isOpen=!1;this._lastDeviceId=void 0;this.arrDiffCodeInfo=[];this._intervalDetectVideoPause=1E3;this._bTryTakePhoto=b._bTryTakePhoto;this._photoSettings=b._photoSettings||{};this._imageCapture=this._advancedVideoSettings=
null;this._videoOrientation=void 0;this._videoTrack=this._btnClose=this._optGotRsl=this._selRsl=this._selCam=this._cvsDrawArea=this._video=this._videoCapabilities=null;this._frameCount=0;this._1DRememberFrameCount=5;this._1DTrustFrameCount=2};BR.Scanner.loadWasm=BR.loadWasm;BR.Scanner.isLoaded=function(){return BR.isLoaded()};BR.Scanner.createInstance=function(b){return BR.createInstance().then(function(c){var a=b instanceof BR.Scanner?b:new BR.Scanner(b);a.barcodeReader=c;var d=c.getRuntimeSettings();
d.localizationModes=[2,0,0,0,0,0,0,0];d.deblurLevel=2;if(a.runtimeSettings)for(var k in a.runtimeSettings)void 0!=d[k]&&(d[k]=a.runtimeSettings[k]);delete a.runtimeSettings;c.updateRuntimeSettings(d);return a})};BR.Scanner.prototype.getUIElement=function(){return this.UIElement};BR.Scanner.prototype.setUIElement=function(b){this.UIElement=b};BR.Scanner.prototype.destroy=BR.Scanner.prototype.deleteInstance=function(){this.barcodeReader&&this.barcodeReader.deleteInstance()};BR.Scanner.prototype.getScanSettings=
function(){return{duplicateForgetTime:this.duplicateForgetTime,intervalTime:this.intervalTime}};BR.Scanner.prototype.updateScanSettings=BR.Scanner.prototype.setScanSettings=function(b){this.duplicateForgetTime=b.duplicateForgetTime;this.intervalTime=b.intervalTime};BR.Scanner.prototype.getRuntimeSettings=function(){return this.barcodeReader.getRuntimeSettings()};BR.Scanner.prototype.updateRuntimeSettings=function(b){return this.barcodeReader.updateRuntimeSettings(b)};BR.Scanner.prototype.resetRuntimeSettings=
function(){this.barcodeReader.resetRuntimeSettings()};BR.Scanner.prototype._bindUI=function(){for(var b=[this.UIElement],c=$jscomp.makeIterator(this.UIElement.children),a=c.next();!a.done;a=c.next())b.push(a.value);for(c=0;c<b.length;++c){var d=$jscomp.makeIterator(b[c].children);for(a=d.next();!a.done;a=d.next())b.push(a.value)}b=$jscomp.makeIterator(b);for(a=b.next();!a.done;a=b.next())a=a.value,!this._video&&a.classList.contains("dbrScanner-video")?this._video=a:!this._cvsDrawArea&&a.classList.contains("dbrScanner-cvs-drawArea")?
this._cvsDrawArea=a:!this._selCam&&a.classList.contains("dbrScanner-sel-camera")?this._selCam=a:!this._selRsl&&a.classList.contains("dbrScanner-sel-resolution")?(this._selRsl=a,this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dbrScanner-opt-gotResolution" value="got"></option>','<option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="2560" data-height="1440">ask 2560 x 1440</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option>'].join(""),
this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&a.classList.contains("dbrScanner-opt-gotResolution")?this._optGotRsl=a:!this._btnClose&&a.classList.contains("dbrScanner-btn-close")&&(this._btnClose=a);if(!this._video)throw this._unBindUI(),Error("Can not find HTMLVideoElement with class `dbrScanner-video`.");};BR.Scanner.prototype._unBindUI=function(){this._btnClose=this._optGotRsl=this._selRsl=this._selCam=this._cvsDrawArea=this._video=null};BR.Scanner.prototype.getVideoSettings=
function(){return JSON.parse(JSON.stringify(this.videoSettings))};BR.Scanner.prototype.updateVideoSettings=function(b){this.videoSettings=JSON.parse(JSON.stringify(b));return this._isOpen?this.play():Promise.resolve()};BR.Scanner.prototype.isOpen=function(){return this._isOpen};BR.Scanner.prototype.show=BR.Scanner.prototype.open=function(){var b=this;if(!navigator.mediaDevices)return Promise.reject("`navigator.mediaDevices` is not available. Please ensure that you host the site in https.");if(this._isOpen)return Promise.reject("The scanner is already open.");
this._isOpen=!0;this.arrDiffCodeInfo=[];this._frameCount=0;this._lastDeviceId=void 0;try{this._bindUI()}catch(g){return Promise.reject(g)}var c=function(){b.play(b._selCam.value).then(function(){b._isOpen||b.stop()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};this._selCam&&this._selCam.addEventListener("change",c);var a=function(){if(b._selRsl&&-1!=b._selRsl.selectedIndex){var a=b._selRsl.options[b._selRsl.selectedIndex];var c=a.getAttribute("data-width");a=a.getAttribute("data-height")}b.play(void 0,
c,a).then(function(){b._isOpen||b.stop()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};this._selRsl&&this._selRsl.addEventListener("change",a);var d=this._closeWindow=function(){b.stop();b._isOpen=!1;b._selCam&&b._selCam.removeEventListener("change",c);b._selRsl&&b._selRsl.removeEventListener("change",a);b._closeWindow=void 0;b._btnClose&&b._btnClose.removeEventListener("click",d);b.UIElement.style.display="none"};this._btnClose&&this._btnClose.addEventListener("click",d);this.UIElement.parentNode||
(this.UIElement.style.position||(this.UIElement.style.position="fixed"),document.body.appendChild(this.UIElement));"none"==this.UIElement.style.display&&(this.UIElement.style.display="");var k,l,e=this.play().then(function(a){k=a;return b.updateDevice()}).then(function(a){l=a;return Promise.resolve()});var f=b.barcodeReader?Promise.resolve():BR.Scanner.createInstance(b);return Promise.all([e,f]).then(function(){if(!b._isOpen)return b.stop();b._loopReadVideo();return Promise.resolve({width:k.width,
height:k.height,current:l.current,all:l.all})})};BR.Scanner.prototype.play=function(b,c,a){var d=this;return this._isOpen?new Promise(function(k,l){d.stop();BR._onLog&&BR._onLog("======before video========");var e=d.videoSettings;if(/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent))1280<=c?e.video.width=1280:640<=c?e.video.width=640:320<=c&&(e.video.width=320);else if(c||a)c&&(e.video.width={ideal:c}),a&&(e.video.height={ideal:a});b?(delete e.video.facingMode,
e.video.deviceId={exact:b},d._lastDeviceId=b):!e.video.deviceId&&d._lastDeviceId&&(delete e.video.facingMode,e.video.deviceId={ideal:d._lastDeviceId});var f=!1,g=function(){BR._onLog&&BR._onLog("======try getUserMedia========");BR._onLog&&BR._onLog("ask "+JSON.stringify(e.video.width)+"x"+JSON.stringify(e.video.height));navigator.mediaDevices.getUserMedia(e).then(function(a){BR._onLog&&BR._onLog("======get video========");return new Promise(function(b,c){var e=a.getVideoTracks();e.length&&(d._videoTrack=
e[0],self$25.ImageCapture&&(d._imageCapture=new ImageCapture(d._videoTrack)));d._video.srcObject=a;d._video.onloadedmetadata=function(){BR._onLog&&BR._onLog("======play video========");d._video.play().then(function(){BR._onLog&&BR._onLog("======played video========");d._videoTrack.applyConstraints&&d._videoTrack.getCapabilities&&(d._videoCapabilities=d._videoTrack.getCapabilities(),d._advancedVideoSettings={});var a="got "+d._video.videoWidth+"x"+d._video.videoHeight;d._optGotRsl&&(d._optGotRsl.setAttribute("data-width",
d._video.videoWidth),d._optGotRsl.setAttribute("data-height",d._video.videoHeight),d._optGotRsl.innerText=a,d._selRsl&&d._optGotRsl.parentNode==d._selRsl&&(d._selRsl.value="got"));BR._onLog&&BR._onLog(a);b();k({width:d._video.videoWidth,height:d._video.videoHeight})},function(a){c(a)})};d._video.onerror=function(){c()}})}).catch(function(a){BR._onLog&&BR._onLog(a);!f&&e.video?(f=!0,e.video.width=void 0,e.video.height=void 0,g()):l(a)})};g()}):Promise.reject("The scanner is not open.")};BR.Scanner.prototype.pause=
function(){this._video&&this._video.pause()};BR.Scanner.prototype.stop=function(){this._video&&this._video.srcObject&&(BR._onLog&&BR._onLog("======stop video========"),this._video.srcObject.getTracks().forEach(function(b){b.stop()}),this._videoOrientation=this._videoTrack=this._video.srcObject=null)};BR.Scanner.prototype.hide=BR.Scanner.prototype.close=function(){this._isOpen&&this._closeWindow()};BR.Scanner.prototype.getCurrentCamera=function(){return this.updateDevice().then(function(b){return b.current})};
BR.Scanner.prototype.getAllCameras=function(){return this.updateDevice().then(function(b){return b.all})};BR.Scanner.prototype.setCurrentCamera=function(b){return this.play(b.deviceId||b)};BR.Scanner.prototype.updateDevice=function(){var b=this;return navigator.mediaDevices.enumerateDevices().then(function(c){var a=[],d;if(b._selCam){var k=b._selCam.value;b._selCam.innerHTML=""}for(var l=0;l<c.length;++l){var e=c[l];if("videoinput"==e.kind){var f={};f.deviceId=e.deviceId;f.label=e.label||"camera "+
l;a.push(f)}}c=void 0;if(b._video)for(l=$jscomp.makeIterator(b._video.srcObject.getVideoTracks()),e=l.next();!e.done;e=l.next()){e=e.value;if(c)break;f=$jscomp.makeIterator(a);for(var g=f.next();!g.done;g=f.next())if(g=g.value,e.label==g.label){c=g;b._lastDeviceId=g.deviceId;break}}if(b._selCam){l=$jscomp.makeIterator(a);for(g=l.next();!g.done;g=l.next())e=g.value,f=document.createElement("option"),f.value=e.deviceId,f.innerText=e.label,b._selCam.appendChild(f),k==e.deviceId&&(d=f);k=b._selCam.childNodes;
if(!d&&c&&k.length)for(k=$jscomp.makeIterator(k),l=k.next();!l.done;l=k.next())if(l=l.value,c.label==l.innerText){d=l;break}d&&(b._selCam.value=d.value)}return Promise.resolve({current:c,all:a})})};BR.Scanner.prototype.getResolution=function(){return this._isOpen?[this._video.videoWidth,this._video.videoHeight]:null};BR.Scanner.prototype.setResolution=function(b,c){return this._isOpen?(b instanceof Array&&(b=b[0],c=b[1]),this.play(null,b,c)):Promise.reject()};BR.Scanner.prototype.getCompatibility=
function(){return{torch:this._videoCapabilities?this._videoCapabilities.torch||!1:!1,focus:!1}};BR.Scanner.prototype.turnOnTorch=function(){return this.getCompatibility().torch?(this._advancedVideoSettings.torch=!0,this._videoTrack.applyConstraints({advanced:[this._advancedVideoSettings]})):Promise.reject("Not support or camera not open.")};BR.Scanner.prototype.turnOffTorch=function(){return this.getCompatibility().torch?(this._advancedVideoSettings.torch=!1,this._videoTrack.applyConstraints({advanced:[this._advancedVideoSettings]})):
Promise.reject("Not support or camera not open.")};BR.Scanner.prototype._cloneDecodeResults=function(b,c){if(b instanceof Array){var a=[];b=$jscomp.makeIterator(b);for(var d=b.next();!d.done;d=b.next())a.push(this._cloneDecodeResults(d.value,c));return a}a=JSON.parse(JSON.stringify(b,function(a,b){if("oriVideoCanvas"!=a&&"searchRegionCanvas"!=a)return b}));c||(a.oriVideoCanvas=b.oriVideoCanvas,a.searchRegionCanvas=b.searchRegionCanvas);return a};BR.Scanner.prototype._loopReadVideo=function(){var b=
this;if(this._isOpen)if(this._video.paused)BR._onLog&&BR._onLog("Video is paused. Ask in 1s."),setTimeout(function(){b._loopReadVideo()},this._intervalDetectVideoPause);else{BR._onLog&&BR._onLog("======= once read =======");var c=(new Date).getTime();(function(){var a=JSON.parse(JSON.stringify(b.searchRegion));a.bAddOriVideoCanvasToResult=b.bAddOriVideoCanvasToResult;a.bAddSearchRegionCanvasToResult=b.bAddSearchRegionCanvasToResult;return!b._bTryTakePhoto||!b._imageCapture||b._advancedVideoSettings&&
b._advancedVideoSettings.torch||"live"!=b._videoTrack.readyState||!b._videoTrack.enabled||b._videoTrack.muted?b.barcodeReader.decodeVideo.apply(b.barcodeReader,[b._video,a]):b._imageCapture.takePhoto(b._photoSettings).then(function(c){a.videoWidth=b._video.videoWidth;a.videoHeight=b._video.videoHeight;return b._videoOrientation||"image/jpeg"!=c.type?c:new Promise(function(a){EXIF.getData(c,function(){b._videoOrientation=EXIF.getTag(this,"Orientation");a(c)})})}).then(function(c){a._videoOrientation=
b._videoOrientation;return b.barcodeReader._decodeBlob(c,a)})})().then(function(a){var d=(new Date).getTime();BR._onLog&&BR._onLog("time cost: "+(d-c)+"ms");++b._frameCount;BR._onLog&&BR._onLog(a);for(var k=[],l=$jscomp.makeIterator(a),e=l.next();!e.done;e=l.next()){e=e.value;for(var f=!1,g=0;g<b.arrDiffCodeInfo.length;++g){var n=b.arrDiffCodeInfo[g];if(n.result.BarcodeText==e.BarcodeText&&n.result.BarcodeFormat==e.BarcodeFormat){n.time=d;n.result=b._cloneDecodeResults(e,!0);++n.count;f=!0;0!=(e.BarcodeFormat&
BR.EnumBarcodeFormat.OneD)&&(g=n.frameCounts,g.push(b._frameCount),g.length==b._1DTrustFrameCount?k.push(e):g.length>b._1DTrustFrameCount&&g.shift());break}}f||(b.arrDiffCodeInfo.push({result:b._cloneDecodeResults(e,!0),time:d,count:1}),0==(e.BarcodeFormat&BR.EnumBarcodeFormat.OneD)?k.push(e):b.arrDiffCodeInfo[b.arrDiffCodeInfo.length-1].frameCounts=[b._frameCount])}for(l=0;l<b.arrDiffCodeInfo.length;++l)e=b.arrDiffCodeInfo[l],e.time+b.duplicateForgetTime<d&&(0==(e.result.BarcodeFormat&BR.EnumBarcodeFormat.OneD)?
b.arrDiffCodeInfo.splice(l,1):(e=e.frameCounts,b._frameCount-e[e.length-1]>=b._1DRememberFrameCount&&b.arrDiffCodeInfo.splice(l,1)));if(b.onFrameRead)b.onFrameRead(b._cloneDecodeResults(a));a=$jscomp.makeIterator(k);for(e=a.next();!e.done;e=a.next())if(d=e.value,b.onUnduplicatedRead)b.onUnduplicatedRead(d.BarcodeText,b._cloneDecodeResults(d));setTimeout(function(){b._loopReadVideo()},b.intervalTime)}).catch(function(a){BR._onLog&&BR._onLog(a.message||a);setTimeout(function(){b._loopReadVideo()},b.intervalTime);
if("platform error"!=a.message)throw console.error(a.message),a;})}}}
var BarcodeScanner=BarcodeReader.BarcodeScanner=BarcodeReader.Scanner,EXIF=dbrEnv._bDom?function(){function b(a,b){b||a.match(/^data:([^;]+);base64,/mi);a=a.replace(/^data:([^;]+);base64,/gmi,"");a=atob(a);b=a.length;for(var c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c}function c(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(a){200!=this.status&&0!==this.status||b(this.response)};c.send()}function a(a,g){function h(b){var c=
d(b);a:{var h=new DataView(b);if(255!=h.getUint8(0)||216!=h.getUint8(1))h=!1;else{for(var f=2,m=b.byteLength;f<m;){var k=h,q=f;if(56===k.getUint8(q)&&66===k.getUint8(q+1)&&73===k.getUint8(q+2)&&77===k.getUint8(q+3)&&4===k.getUint8(q+4)&&4===k.getUint8(q+5)){k=h.getUint8(f+7);0!==k%2&&(k+=1);0===k&&(k=4);m=f+8+k;f=h.getUint16(f+6+k);h=m;m=new DataView(b);k={};for(q=h;q<h+f;){if(28===m.getUint8(q)&&2===m.getUint8(q+1)){var l=m.getUint8(q+2);if(l in A){var v=m.getInt16(q+3);l=A[l];v=e(m,q+5,v);k.hasOwnProperty(l)?
k[l]instanceof Array?k[l].push(v):k[l]=[k[l],v]:k[l]=v}}q++}h=k;break a}f++}h=void 0}}a:if("DOMParser"in self)if(f=new DataView(b),255!=f.getUint8(0)||216!=f.getUint8(1))var z=!1;else{m=2;k=b.byteLength;for(b=new DOMParser;m<k-4;)if("http"==e(f,m,4)){k=m-1;m=f.getUint16(m-2)-1;f=e(f,k,m);m=f.indexOf("xmpmeta>")+8;f=f.substring(f.indexOf("<x:xmpmeta"),m);m=f.indexOf("x:xmpmeta")+10;f=f.slice(0,m)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+
f.slice(m);b:{b=b.parseFromString(f,"text/xml");try{f={};if(0<b.children.length)for(m=0;m<b.children.length;m++){var r=b.children.item(m),n=r.attributes,p;for(p in n){var y=n[p],t=y.nodeName,u=y.nodeValue;void 0!==t&&(f[t]=u)}var w=r.nodeName;if("undefined"==typeof f[w])f[w]=xml2json(r);else{if("undefined"==typeof f[w].push){var x=f[w];f[w]=[];f[w].push(x)}f[w].push(xml2json(r))}}else f=b.textContent;z=f;break b}catch(B){console.log(B.message)}z=void 0}break a}else m++;z=void 0}else z=void 0;a.exifdata=
c||{};a.iptcdata=h||{};a.xmpdata=z||{};g&&g.call(a)}if(a.src)if(/^data:/i.test(a.src)){var f=b(a.src);h(f)}else if(/^blob:/i.test(a.src)){var m=new FileReader;m.onload=function(a){h(a.target.result)};c(a.src,function(a){m.readAsArrayBuffer(a)})}else{var k=new XMLHttpRequest;k.onload=function(){if(200==this.status||0===this.status)h(k.response);else throw"Could not load image";k=null};k.open("GET",a.src,!0);k.responseType="arraybuffer";k.send(null)}else self.FileReader&&(a instanceof self.Blob||a instanceof
self.File)&&(m=new FileReader,m.onload=function(a){h(a.target.result)},m.readAsArrayBuffer(a))}function d(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;var c=2;a=a.byteLength;for(var d;c<a;){if(255!=b.getUint8(c))return!1;d=b.getUint8(c+1);if(225==d)return f(b,c+4,b.getUint16(c+2)-2);c+=2+b.getUint16(c+2)}}function k(a,b,c,d,e){var h=a.getUint16(c,!e),f={},g;for(g=0;g<h;g++){var m=c+12*g+2;var k=d[a.getUint16(m,!e)];f[k]=l(a,m,b,c,e)}return f}function l(a,b,c,d,f){var g=
a.getUint16(b+2,!f);d=a.getUint32(b+4,!f);c=a.getUint32(b+8,!f)+c;switch(g){case 1:case 7:if(1==d)return a.getUint8(b+8,!f);c=4<d?c:b+8;b=[];for(g=0;g<d;g++)b[g]=a.getUint8(c+g);return b;case 2:return e(a,4<d?c:b+8,d-1);case 3:if(1==d)return a.getUint16(b+8,!f);c=2<d?c:b+8;b=[];for(g=0;g<d;g++)b[g]=a.getUint16(c+2*g,!f);return b;case 4:if(1==d)return a.getUint32(b+8,!f);b=[];for(g=0;g<d;g++)b[g]=a.getUint32(c+4*g,!f);return b;case 5:if(1==d){var h=a.getUint32(c,!f);var k=a.getUint32(c+4,!f);a=new Number(h/
k);a.numerator=h;a.denominator=k;return a}b=[];for(g=0;g<d;g++)h=a.getUint32(c+8*g,!f),k=a.getUint32(c+4+8*g,!f),b[g]=new Number(h/k),b[g].numerator=h,b[g].denominator=k;return b;case 9:if(1==d)return a.getInt32(b+8,!f);b=[];for(g=0;g<d;g++)b[g]=a.getInt32(c+4*g,!f);return b;case 10:if(1==d)return a.getInt32(c,!f)/a.getInt32(c+4,!f);b=[];for(g=0;g<d;g++)b[g]=a.getInt32(c+8*g,!f)/a.getInt32(c+4+8*g,!f);return b}}function e(a,b,c){for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a.getUint8(e));return d}
function f(a,b){if("Exif"!=e(a,b,4))return!1;var c=b+6;if(18761==a.getUint16(c))var d=!1;else if(19789==a.getUint16(c))d=!0;else return!1;if(42!=a.getUint16(c+2,!d))return!1;var g=a.getUint32(c+4,!d);if(8>g)return!1;b=k(a,c,c+g,x,d);if(b.ExifIFDPointer){var f=k(a,c,c+b.ExifIFDPointer,n,d);for(h in f){switch(h){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":f[h]=
p[h][f[h]];break;case "ExifVersion":case "FlashpixVersion":f[h]=String.fromCharCode(f[h][0],f[h][1],f[h][2],f[h][3]);break;case "ComponentsConfiguration":f[h]=p.Components[f[h][0]]+p.Components[f[h][1]]+p.Components[f[h][2]]+p.Components[f[h][3]]}b[h]=f[h]}}if(b.GPSInfoIFDPointer)for(h in f=k(a,c,c+b.GPSInfoIFDPointer,t,d),f){switch(h){case "GPSVersionID":f[h]=f[h][0]+"."+f[h][1]+"."+f[h][2]+"."+f[h][3]}b[h]=f[h]}var h=d;g=c+g;d=a.getUint16(g,!h);if(g=a.getUint32(g+2+12*d,!h))if(g>a.byteLength)a=
{};else{h=k(a,c,c+g,u,h);if(h.Compression)switch(h.Compression){case 6:h.JpegIFOffset&&h.JpegIFByteCount&&(h.blob=new Blob([new Uint8Array(a.buffer,c+h.JpegIFOffset,h.JpegIFByteCount)],{type:"image/jpeg"}));break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",h.Compression)}else 2==h.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");a=h}else a={};b.thumbnail=
a;return b}var g=function(a){if(a instanceof g)return a;if(!(this instanceof g))return new g(a);this.EXIFwrapped=a},n=g.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",
33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",
41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},x=g.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",
34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",
532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},t=g.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",
21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},u=g.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",
296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},p=g.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",
1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",
7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",
3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},A={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};g.getData=
function(b,c){if((self.Image&&b instanceof self.Image||self.HTMLImageElement&&b instanceof self.HTMLImageElement)&&!b.complete)return!1;b.exifdata?c&&c.call(b):a(b,c);return!0};g.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};g.getIptcTag=function(a,b){if(a.exifdata)return a.iptcdata[b]};g.getAllTags=function(a){if(!a.exifdata)return{};var b;a=a.exifdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};g.getAllIptcTags=function(a){if(!a.exifdata)return{};var b;a=a.iptcdata;
var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};g.pretty=function(a){if(!a.exifdata)return"";var b;a=a.exifdata;var c="";for(b in a)a.hasOwnProperty(b)&&(c="object"==typeof a[b]?a[b]instanceof Number?c+(b+" : "+a[b]+" ["+a[b].numerator+"/"+a[b].denominator+"]\r\n"):c+(b+" : ["+a[b].length+" values]\r\n"):c+(b+" : "+a[b]+"\r\n"));return c};g.readFromBinaryFile=function(a){return d(a)};return g}():void 0;

let EnumBarcodeFormat = BarcodeReader.EnumBarcodeFormat;
let EnumErrorCode = BarcodeReader.EnumErrorCode;
let EnumImagePixelFormat = BarcodeReader.EnumImagePixelFormat;
let EnumResultType = BarcodeReader.EnumResultType;
let EnumTerminatePhase = BarcodeReader.EnumTerminatePhase;
let EnumConflictMode = BarcodeReader.EnumConflictMode;
let EnumLocalizationMode = BarcodeReader.EnumLocalizationMode;
export default BarcodeReader;
export {BarcodeReader, BarcodeScanner, EnumBarcodeFormat, EnumErrorCode, EnumImagePixelFormat, EnumResultType, EnumTerminatePhase, EnumConflictMode, EnumLocalizationMode};