/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Barcode Reader JS Edition
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2019, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 7.1.3
 * @fileoverview Dynamsoft JavaScript Library for Barcode Reader
 * More info on DBR JS: https://www.dynamsoft.com/Products/barcode-recognition-javascript.aspx
 */
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(t){var p=0;return function(){return p<t.length?{done:!1,value:t[p++]}:{done:!0}}};$jscomp.arrayIterator=function(t){return{next:$jscomp.arrayIteratorImpl(t)}};$jscomp.makeIterator=function(t){var p="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return p?p.call(t):$jscomp.arrayIterator(t)};
(function(t,p){"undefined"!=typeof self&&self.document&&(self.__dbrWasmCurrentScript__=document.currentScript.src.substring(0,document.currentScript.src.lastIndexOf("/")),self.__dbrLicenseKey__=document.currentScript.getAttribute("data-licenseKey"),self.__dbrProductKeys__=document.currentScript.getAttribute("data-productKeys"));"function"===typeof define&&(define.amd||define.cmd)?define(p):"object"===typeof module&&module.exports?(t=p(),module.exports=t):(p=p(),t.dynamsoft=t.dynamsoft||{},t.dynamsoft.BarcodeReader=
p,t.dynamsoft.BarcodeScanner=p.Scanner,t.dynamsoft.EnumBarcodeFormat=p.EnumBarcodeFormat,t.dynamsoft.EnumErrorCode=p.EnumErrorCode,t.dynamsoft.EnumImagePixelFormat=p.EnumImagePixelFormat,t.dynamsoft.EnumResultType=p.EnumResultType,t.dynamsoft.EnumTerminatePhase=p.EnumTerminatePhase,t.dynamsoft.EnumConflictMode=p.EnumConflictMode,t.dynamsoft.EnumLocalizationMode=p.EnumLocalizationMode,t.Dynamsoft=t.Dynamsoft||{},t.Dynamsoft.BarcodeReader=p,t.Dynamsoft.BarcodeScanner=p.Scanner,t.Dynamsoft.EnumBarcodeFormat=
p.EnumBarcodeFormat,t.Dynamsoft.EnumErrorCode=p.EnumErrorCode,t.Dynamsoft.EnumImagePixelFormat=p.EnumImagePixelFormat,t.Dynamsoft.EnumResultType=p.EnumResultType,t.Dynamsoft.EnumTerminatePhase=p.EnumTerminatePhase,t.Dynamsoft.EnumConflictMode=p.EnumConflictMode,t.Dynamsoft.EnumLocalizationMode=p.EnumLocalizationMode,t.BarcodeReader=t.BarcodeReader||p,t.BarcodeScanner=t.BarcodeScanner||p.Scanner,t.dbr=t.dbr||p)})(this,function(){var t=function(){var a=function(){this._queue=[];this.isWorking=!1;this.timeout=
100};a.prototype.push=function(a,b,g){this._queue.push({task:a,context:b,args:g});this.isWorking||this.next()};a.prototype.unshift=function(a,b,g){this._queue.unshift({task:a,context:b,args:g});this.isWorking||this.next()};a.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var a=this._queue.shift(),b=a.task,g=a.context?a.context:null,n=a.args?a.args:[];setTimeout(function(){b.apply(g,n)},this.timeout)}};return a}(),p,x;if("undefined"!=typeof self){var v=
self;self.document?p=!0:x=!0}else{v=global;var w=!0}var D=function(a,c){var b={"M+":a.getUTCMonth()+1,"d+":a.getUTCDate(),"h+":a.getUTCHours(),"m+":a.getUTCMinutes(),"s+":a.getUTCSeconds(),"q+":Math.floor((a.getUTCMonth()+3)/3),S:a.getUTCMilliseconds()};/(y+)/.test(c)&&(c=c.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var g in b)(new RegExp("("+g+")")).test(c)&&(c=c.replace(RegExp.$1,1==RegExp.$1.length?b[g]:("00"+b[g]).substr((""+b[g]).length)));return c},a=function(){var a=
v,c=function(a){a=a||c.productKeys||c.licenseKey||"";if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'Constructor BarcodeReader(productKeys)': Type of 'productKeys' should be 'String'.");this._productKeys=a;if(!c.isLoaded())throw Error("'Constructor BarcodeReader(productKeys)': Autoload haven't start or you want to call `loadWasm` manually.");p||(this._instance=new c._BarcodeReaderWasm(a),8==a.length&&this._instance.InitSettingsFromServer(JSON.stringify({key:a,licenseinfo:c._runtimeLicenseResponse.licenseinfo,
bDebug:!!c._bWasmRuntimeLicenseDebug,initTime:D(new Date,"yyyyMMddhhmmss")})))};c._jsVersion="7.1.3";c._jsEditVersion="20190729";c.version="loading...(JS "+c._jsVersion+"."+c._jsEditVersion+")";c.isLoaded=function(){return"loaded"==this._loadWasmStatus};c._dbName="dynamsoft-dbr-wasm-"+c._jsVersion;c._DB=void 0;c._licenseUrls=["https://dbrauthorize.dynamsoft.com/api/DbrLicense/WasmGetLicense","https://dbrauthorize.dynamsoft.net/api/DbrLicense/WasmGetLicense"];c.licenseKey=a.__dbrLicenseKey__;c.productKeys=
a.__dbrProductKeys__;c._runtimeLicenseResponse=void 0;var d=p?a.__dbrWasmCurrentScript__?__dbrWasmCurrentScript__:__dbrESMCurrentScript__:void 0;c._resourcesPath=d;c._workerName=void 0;c._wasmjsName=void 0;c._wasmName=void 0;c._workerResourcePath=void 0;c._wasmjsResourcePath=void 0;c._wasmResourcePath=void 0;c._isShowRelDecodeTimeInResults=!1;c._bCustomWorker=void 0;c._bWithio=void 0;c._onWasmDownloaded=void 0;c._bLoadWorkerDirectlyFromUrl=void 0;c._onLog=void 0;c._canvasMaxWH=4096;c._bUseIndexDB=
!0;c._bDebuggerInWorker=!1;c._indexPostUrl=0;c.createInstance=function(a){return c.loadWasm().then(function(){var e=new c(a);return p?e._createWorkerInstance():Promise.resolve(e)})};var g=c._workerCallbackDic={};c._loadWorker=function(){return new Promise(function(a,f){var e=c._workerName||"dbr-"+c._jsVersion+".min.js";if(c._workerResourcePath||c._resourcesPath){var b=c._workerResourcePath||c._resourcesPath;"/"!=b.charAt(b.length-1)&&(b+="/");void 0===c._bLoadWorkerDirectlyFromUrl&&location&&location.origin&&
0==c._resourcesPath.indexOf(location.origin)&&(c._bLoadWorkerDirectlyFromUrl=!0);e=b+e}Promise.resolve().then(function(){return c._bLoadWorkerDirectlyFromUrl?e:fetch(e).then(function(a){return a.blob()}).then(function(a){return URL.createObjectURL(a)})}).then(function(e){var b=c._dbrWorker=new Worker(e);b.onerror=function(a){a="worker error, you should host the page in web service: "+a.message;c._onLog&&c._onLog(a);f(a)};b.onmessage=function(b){b=b.data;switch(b.type){case "log":c._onLog&&c._onLog(b.message);
break;case "load":b.success?(c.version=b.version,c._defaultRuntimeSettings=b._defaultRuntimeSettings,c._onLog&&c._onLog("load dbr worker success"),a()):f(b.exception);c._bLoadWorkerDirectlyFromUrl||URL.revokeObjectURL(e);break;case "task":try{g[b.id](b.body),g[b.id]=void 0}catch(h){throw g[b.id]=void 0,h;}break;default:c._onLog&&c._onLog(b)}};var k=document.createElement("a");k.href=c._resourcesPath||"./";var l=void 0;c._wasmjsResourcePath&&(l=document.createElement("a"),l.href=c._wasmjsResourcePath||
"./",l=l.href);var d=void 0;c._wasmResourcePath&&(d=document.createElement("a"),d.href=c._wasmResourcePath||"./",d=d.href);b.postMessage({type:"loadWorker",_licenseUrls:c._licenseUrls,productKeys:c.productKeys,_resourcesPath:k.href,_wasmjsResourcePath:l,_wasmResourcePath:d,_bUseIndexDB:c._bUseIndexDB,_bDebuggerInWorker:c._bDebuggerInWorker,_bWasmRuntimeLicenseDebug:c._bWasmRuntimeLicenseDebug,origin:location.origin})}).catch(function(a){f(a)})})};c.prototype._createWorkerInstance=function(){var a=
this;return new Promise(function(e,b){var f=Math.random();g[f]=function(f){return f.success?f.instanceID?(a._instanceID=f.instanceID,e(a)):b(c.BarcodeReaderException(c.EnumErrorCode.DBR_NULL_REFERENCE,"Can't create BarcodeReader instance.")):b(f.exception)};c._dbrWorker.postMessage({type:"createInstance",id:f,productKeys:a._productKeys})})};c.prototype.destroy=c.prototype.deleteInstance=function(){var a=this;if(this._instance)this._instance.delete();else if(this._instanceID)return new Promise(function(e,
b){var f=Math.random();g[f]=function(a){return a.success?e():b(a.exception)};c._dbrWorker.postMessage({type:"deleteInstance",id:f,instanceID:a._instanceID})})};c.prototype._decodeBlob=function(e,f){var c=this;if(!(a.Blob&&e instanceof Blob))return Promise.reject("'_decodeBlob(blob, config)': Type of 'blob' should be 'Blob'.");if(p){var b=function(a){return new Promise(function(e,f){var c=URL.createObjectURL(a),b=new Image;b.dbrObjUrl=c;b.src=c;b.onload=function(){e(b)};b.onerror=function(){f(TypeError("'_decodeBlob(blob, config)': Can't convert the blob to image."))}})},
d;return function(){return a.createImageBitmap?createImageBitmap(e).then(function(a){return d=a},function(){return b(e)}):b(e)}().then(function(a){return c._decodeImage(a,f)}).then(function(a){d&&d.close();return a})}return(new Promise(function(a){var f=new FileReader;f.onload=function(){a(f.result)};f.readAsArrayBuffer(e)})).then(function(a){return c._decodeArrayBuffer(a,f)})};c.prototype._decodeArrayBuffer=function(e,f){return a.arrayBuffer&&e instanceof ArrayBuffer||a.Buffer&&e instanceof Buffer?
p?this._decodeBlob(new Blob(e),f):this._decodeUint8Array(new Uint8Array(e),f):Promise.reject("'_decodeArrayBuffer(arrayBuffer, config)': Type of 'arrayBuffer' should be 'ArrayBuffer' or 'Buffer'.")};c.prototype._decodeUint8Array=function(e,f){var b=this;if(!(a.Uint8Array&&e instanceof Uint8Array||a.Uint8ClampedArray&&e instanceof Uint8ClampedArray))return Promise.reject("'_decodeBlob(uint8Array, config)': Type of 'uint8Array' should be 'Uint8Array'.");if(p)return this._decodeBlob(new Blob(e),f);var k=
f?f.templateName||"":"";return new Promise(function(a){if(c._isShowRelDecodeTimeInResults){var f=(new Date).getTime(),u=b._instance.DecodeFileInMemory(e,k);f=(new Date).getTime()-f;u=n(u);u._decodeTime=f;return a(u)}return a(n(b._instance.DecodeFileInMemory(e,k)))})};c.prototype._decodeImage=function(e,f){var b=this;f=f||{};return(new Promise(function(f){if(!(a.HTMLImageElement&&e instanceof HTMLImageElement||a.ImageBitmap&&e instanceof ImageBitmap))throw TypeError("'_decodeImage(image, config)': Type of 'image' should be 'HTMLImageElement or ImageBitmap'.");
if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";f()})).then(function(){var a=e.naturalWidth||e.width,d=e.naturalHeight||e.height,m=document.createElement("canvas"),u=void 0,g=Math.max(a,d);g>c._canvasMaxWH&&(g=c._canvasMaxWH/g,a=Math.round(a*g),d=Math.round(d*g));g=m.getContext("2d");switch(f._videoOrientation){case 3:m.width=a;m.height=d;g.setTransform(-1,0,0,-1,a,d);break;case 6:m.width=d;m.height=a;g.setTransform(0,1,-1,0,d,0);break;case 8:m.width=d;m.height=a;g.setTransform(0,-1,1,0,
0,a);break;default:m.width=a,m.height=d}g.drawImage(e,0,0,a,d);if(f.sx||f.sy||f.sWidth||f.sHeight||f.dWidth||f.dHeight){a=d=0;g=m.width;var l=m.height,n=m.width,h=m.height;void 0!=f.sx&&(d=f.sx);void 0!=f.sy&&(a=f.sy);void 0!=f.sWidth&&(g=f.sWidth);void 0!=f.sHeight&&(l=f.sHeight);void 0!=f.dWidth&&(n=f.dWidth);void 0!=f.dHeight&&(h=f.dHeight);0<d&&1>=d&&(d=Math.round(d*m.width));0<a&&1>=a&&(a=Math.round(a*m.height));1>=g&&(g=Math.round(g*m.width));1>=l&&(l=Math.round(l*m.height));1>=n&&(n=Math.round(n*
m.width));1>=h&&(h=Math.round(h*m.height));u=document.createElement("canvas");u.getContext("2d").drawImage(m,d,a,g,l,0,0,n,h)}e.dbrObjUrl&&URL.revokeObjectURL(e.dbrObjUrl);return b._decodeCanvas(u||m,f).then(function(a){if(f.bAddOriVideoCanvasToResult)for(var e=$jscomp.makeIterator(a),b=e.next();!b.done;b=e.next())b.value.oriVideoCanvas=m;if(f.bAddSearchRegionCanvasToResult)for(e=$jscomp.makeIterator(a),b=e.next();!b.done;b=e.next())b.value.searchRegionCanvas=u;return a})})};c.prototype._decodeCanvas=
function(e,f){var b=this;return(new Promise(function(f){if(!(a.HTMLCanvasElement&&e instanceof HTMLCanvasElement))throw TypeError("'_decodeCanvas(canvas, config)': Type of 'canvas' should be 'HTMLCanvasElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";var b=e.getContext("2d").getImageData(0,0,e.width,e.height).data;f(b)})).then(function(a){return b._decodeRawImageUint8Array(a,e.width,e.height,4*e.width,c.EnumImagePixelFormat.IPF_ARGB_8888,f)})};c.prototype._decodeVideo=c.prototype.decodeVideo=
function(e,f){var b=this,c,d;f=f||{};return(new Promise(function(b){if(!(a.HTMLVideoElement&&e instanceof HTMLVideoElement))throw TypeError("'_decodeVideo(video [, config] )': Type of 'video' should be 'HTMLVideoElement'.");if(e.crossOrigin&&"anonymous"!=e.crossOrigin)throw"cors";var g=0,m=0,k=e.videoWidth,l=e.videoHeight,h=e.videoWidth,q=e.videoHeight;void 0!=f.sx&&(g=f.sx);void 0!=f.sy&&(m=f.sy);void 0!=f.sWidth&&(k=f.sWidth);void 0!=f.sHeight&&(l=f.sHeight);void 0!=f.dWidth&&(h=f.dWidth);void 0!=
f.dHeight&&(q=f.dHeight);0<g&&1>=g&&(g=Math.round(g*e.videoWidth));0<m&&1>=m&&(m=Math.round(m*e.videoHeight));1>=k&&(k=Math.round(k*e.videoWidth));1>=l&&(l=Math.round(l*e.videoHeight));1>=h&&(h=Math.round(h*e.videoWidth));1>=q&&(q=Math.round(q*e.videoHeight));f.bAddOriVideoCanvasToResult&&(c=document.createElement("canvas"),c.width=e.videoWidth,c.height=e.videoHeight,c.getContext("2d").drawImage(e,0,0));d=document.createElement("canvas");d.width=h;d.height=q;var r=d.getContext("2d");0==g&&0==m&&e.videoWidth==
k&&e.videoHeight==l&&e.videoWidth==h&&e.videoHeight==q?r.drawImage(c||e,0,0):r.drawImage(c||e,g,m,k,l,0,0,h,q);b()})).then(function(){var a=JSON.parse(JSON.stringify(f));a.sx=void 0;a.sy=void 0;a.sWidth=void 0;a.sHeight=void 0;a.dWidth=void 0;a.dHeight=void 0;return b._decodeCanvas(d,f)}).then(function(a){if(f.bAddOriVideoCanvasToResult)for(var e=$jscomp.makeIterator(a),b=e.next();!b.done;b=e.next())b.value.oriVideoCanvas=c;if(f.bAddSearchRegionCanvasToResult)for(e=$jscomp.makeIterator(a),b=e.next();!b.done;b=
e.next())b.value.searchRegionCanvas=d;return a})};c.prototype._decodeBase64=c.prototype.decodeBase64String=function(a,b){var e=this;if(!("string"==typeof a||"object"==typeof a&&a instanceof String))return Promise.reject("'decodeBase64(base64Str, config)': Type of 'base64Str' should be 'String'.");"data:image/"==a.substring(0,11)&&(a=a.substring(a.indexOf(",")+1));return new Promise(function(f){if(w)f(e._decodeArrayBuffer(Buffer.from(a,"base64"),b));else{for(var c=atob(a),d=c.length,g=new Uint8Array(d);d--;)g[d]=
c.charCodeAt(d);p?f(e._decodeBlob(new Blob([g]),b)):f(e._decodeUint8Array(g,b))}})};c.prototype._decodeUrl=function(a,b){var e=this;return new Promise(function(f,c){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeUrl(url, config)': Type of 'url' should be 'String'.");if(w)(a.startsWith("https")?require("https"):require("http")).get(a,function(a){if(200==a.statusCode){var d=[];a.on("data",function(a){d.push(a)}).on("end",function(){f(e._decodeArrayBuffer(Buffer.concat(d),
b))})}else c("http get fail, statusCode: "+a.statusCode)});else{var d=new XMLHttpRequest;d.open("GET",a,!0);d.responseType=p?"blob":"arraybuffer";d.send();d.onloadend=function(){p?f(e._decodeBlob(d.response,b)):f(e._decodeArrayBuffer(d.response,b))};d.onerror=function(){c(d.error)}}})};c.prototype._decodeFilePath=function(a,b){var e=this;return new Promise(function(f,c){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))throw TypeError("'_decodeFilePath(path, config)': Type of 'path' should be 'String'.");
require("fs").readFile(a,function(a,d){a?c(a):f(e._decodeArrayBuffer(d,b))})})};c.prototype._decodeRawImageBlob=function(e,b,c,d,g,m){var f=this;return(new Promise(function(b,f){if(!(a.Blob&&e instanceof Blob))throw TypeError("'_decodeRawImageBlob(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'Blob'.");var c=new FileReader;c.readAsArrayBuffer(e);c.onload=function(){b(c.result)};c.onerror=function(){f(c.error)}})).then(function(a){return f._decodeRawImageUint8Array(new Uint8Array(a),
b,c,d,g,m)})};c.prototype._decodeRawImageArrayBuffer=function(e,b,c,d,g,m){var f=this;return(new Promise(function(b){if(!(a.ArrayBuffer&&e instanceof ArrayBuffer))throw TypeError("'_decodeRawImageArrayBuffer(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'ArrayBuffer'.");b()})).then(function(){return f._decodeRawImageUint8Array(new Uint8Array(e),b,c,d,g,m)})};c.prototype._decodeRawImageUint8Array=function(e,b,d,k,A,m){var f=this;return(new Promise(function(b){if(!(a.Uint8Array&&
e instanceof Uint8Array||a.Uint8ClampedArray&&e instanceof Uint8ClampedArray))throw TypeError("'_decodeRawImageUint8Array(buffer, width, height, stride, enumImagePixelFormat, config)': Type of 'buffer' should be 'Uint8Array'.");b()})).then(function(){var a=m?m.templateName||"":"";if(f._instance){var l=c._isShowRelDecodeTimeInResults?(new Date).getTime():void 0;try{var u=f._instance.DecodeBuffer(e,b,d,k,A,a)}catch(y){return setTimeout(function(){console.error("wasm error!");throw y;},0),Promise.reject(y)}a=
c._isShowRelDecodeTimeInResults?(new Date).getTime()-l:void 0;u=n(u);c._isShowRelDecodeTimeInResults&&(u._decodeTime=a);if(m.videoWidth&&m.videoHeight){a=1;var h=l=0;a=b/d>=m.videoWidth/m.videoHeight?m.videoHeight/d:m.videoWidth/b;l=(b*a-m.videoWidth)/2;h=(d*a-m.videoHeight)/2;for(var q=0;q<u.length;++q){var r=u[q].LocalizationResult;r.X1=r.X1*a-l;r.X2=r.X2*a-l;r.X3=r.X3*a-l;r.X4=r.X4*a-l;r.Y1=r.Y1*a-h;r.Y2=r.Y2*a-h;r.Y3=r.Y3*a-h;r.Y4=r.Y4*a-h}}return Promise.resolve(u)}u=f._instanceID?Promise.resolve():
f._createWorkerInstance();return u.then(function(){return null===f._runtimeSettings?new Promise(function(a,b){var e=Math.random();g[e]=function(e){return e.success?(f._runtimeSettings=void 0,a()):b(e.exception)};c._dbrWorker.postMessage({type:"resetRuntimeSettings",id:e,instanceID:f._instanceID})}):Promise.resolve()}).then(function(){return new Promise(function(a,h){var q=Math.random();g[q]=function(b){return b.success?a(b.results):h(b.exception)};c._dbrWorker.postMessage({type:"decodeRawImageUint8Array",
id:q,instanceID:f._instanceID,body:{buffer:e,width:b,height:d,stride:k,enumImagePixelFormat:A,config:m},_isShowRelDecodeTimeInResults:c._isShowRelDecodeTimeInResults})})})})};c.prototype.decode=c.prototype.decodeFileInMemory=function(b,f){return a.Blob&&b instanceof Blob?this._decodeBlob(b,f):a.ArrayBuffer&&b instanceof ArrayBuffer||a.Buffer&&b instanceof Buffer?this._decodeArrayBuffer(b,f):a.Uint8Array&&b instanceof Uint8Array||a.Uint8ClampedArray&&b instanceof Uint8ClampedArray?this._decodeUint8Array(b,
f):a.HTMLImageElement&&b instanceof HTMLImageElement||a.ImageBitmap&&b instanceof ImageBitmap?this._decodeImage(b,f):a.HTMLCanvasElement&&b instanceof HTMLCanvasElement?this._decodeCanvas(b,f):a.HTMLVideoElement&&b instanceof HTMLVideoElement?this._decodeVideo(b,f):"string"==typeof b||b instanceof String?"data:image/"==b.substring(0,11)?this._decodeBase64(b,f):w?"http"==b.substring(0,4)?this._decodeUrl(b,f):this._decodeFilePath(b,f):this._decodeUrl(b,f):Promise.reject(TypeError("'_decode(source, config)': Type of 'source' should be 'Blob', 'ArrayBuffer', 'Uint8Array', 'HTMLImageElement', 'HTMLCanvasElement', 'HTMLVideoElement', 'String(base64 with image mime)' or 'String(url)'."))};
c.prototype._decodeRawImage=c.prototype.decodeBuffer=function(b,f,c,d,g,m){return a.Blob&&b instanceof Blob?this._decodeRawImageBlob(b,f,c,d,g,m):a.ArrayBuffer&&b instanceof ArrayBuffer?this._decodeRawImageArrayBuffer(b,f,c,d,g,m):a.Uint8Array&&b instanceof Uint8Array||a.Uint8ClampedArray&&b instanceof Uint8ClampedArray?this._decodeRawImageUint8Array(b,f,c,d,g,m):Promise.reject(TypeError("'_decodeRawImage(source, width, height, stride, enumImagePixelFormat, config)': Type of 'source' should be 'Blob', 'ArrayBuffer' or 'Uint8Array'."))};
var n=c._handleRetJsonString=function(a){a="string"==typeof a||"object"==typeof a&&a instanceof String?JSON.parse(a):a;var b=c.EnumErrorCode;switch(a.exception){case b.DBR_SUCCESS:case b.DBR_LICENSE_INVALID:case b.DBR_LICENSE_EXPIRED:case b.DBR_1D_LICENSE_INVALID:case b.DBR_QR_LICENSE_INVALID:case b.DBR_PDF417_LICENSE_INVALID:case b.DBR_DATAMATRIX_LICENSE_INVALID:case b.DBR_DBRERR_AZTEC_LICENSE_INVALID:case b.DBR_RECOGNITION_TIMEOUT:if(a.textResult)for(b=0;b<a.textResult.length;++b){var e=a.textResult[b];
try{if(w)e.BarcodeText=Buffer.from(e.BarcodeBytes).toString();else{for(var d=e.BarcodeBytes,g="",m=0;m<d.length;m++)g+=String.fromCharCode(d[m]);try{e.BarcodeText=decodeURIComponent(escape(g))}catch(u){e.BarcodeText=g}}}catch(u){e.BarcodeText=""}}return a.textResult||a.settings||a.outputSettings||a;default:throw c.BarcodeReaderException(a.exception,a.description);}};c.prototype.getAllParameterTemplateNames=function(){return n(this._instance.GetAllParameterTemplateNames())};c.prototype.getRuntimeSettings=
function(){return this._instance?n(this._instance.GetRuntimeSettings()):this._runtimeSettings?JSON.parse(this._runtimeSettings):JSON.parse(c._defaultRuntimeSettings)};c.prototype.updateRuntimeSettings=function(a){var b=this;if("string"==typeof a||"object"==typeof a&&a instanceof String)var e=a;else if("object"==typeof a)e=JSON.stringify(a);else throw TypeError("'UpdateRuntimeSettings(settings)': Type of 'settings' should be 'String' or 'PlainObject'.");if(this._instance)try{return n(this._instance.UpdateRuntimeSettings(e)),
Promise.resolve()}catch(k){return Promise.reject(k)}else return this._runtimeSettings=e,Promise.resolve().then(function(){return b._instanceID?Promise.resolve():b._createWorkerInstance()}).then(function(){return new Promise(function(a,f){var d=Math.random();g[d]=function(b){return b.success?a():f(b.exception)};c._dbrWorker.postMessage({type:"updateRuntimeSettings",id:d,instanceID:b._instanceID,body:{settings:e}})})}).catch(function(a){return Promise.reject(a)})};c.prototype.resetRuntimeSettings=function(){this._instance?
n(this._instance.ResetRuntimeSettings()):this._runtimeSettings=null};c.prototype.outputSettingsToString=function(a){return n(this._instance.OutputSettingsToString(a||""))};c.prototype.initRuntimeSettingsWithString=function(a,b){if(!("string"==typeof a||"object"==typeof a&&a instanceof String))if("object"==typeof a)a=JSON.stringify(a);else throw TypeError("'initRuntimeSettingstWithString(template, enumComflictMode)': Type of 'template' should be 'String' or 'PlainObject'.");n(this._instance.InitRuntimeSettingstWithString(a,
b?b:2))};c.EnumBarcodeFormat={All:503318527,OneD:2047,CODE_39:1,CODE_128:2,CODE_93:4,CODABAR:8,ITF:16,EAN_13:32,EAN_8:64,UPC_A:128,UPC_E:256,INDUSTRIAL_25:512,CODE_39_EXTENDED:1024,PDF417:33554432,QR_CODE:67108864,DATAMATRIX:134217728,AZTEC:268435456};c.EnumErrorCode={DBR_SYSTEM_EXCEPTION:1,DBR_SUCCESS:0,DBR_UNKNOWN:-1E4,DBR_NO_MEMORY:-10001,DBR_NULL_REFERENCE:-10002,DBR_LICENSE_INVALID:-10003,DBR_LICENSE_EXPIRED:-10004,DBR_FILE_NOT_FOUND:-10005,DBR_FILETYPE_NOT_SUPPORTED:-10006,DBR_BPP_NOT_SUPPORTED:-10007,
DBR_INDEX_INVALID:-10008,DBR_BARCODE_FORMAT_INVALID:-10009,DBR_CUSTOM_REGION_INVALID:-10010,DBR_MAX_BARCODE_NUMBER_INVALID:-10011,DBR_IMAGE_READ_FAILED:-10012,DBR_TIFF_READ_FAILED:-10013,DBR_QR_LICENSE_INVALID:-10016,DBR_1D_LICENSE_INVALID:-10017,DBR_DIB_BUFFER_INVALID:-10018,DBR_PDF417_LICENSE_INVALID:-10019,DBR_DATAMATRIX_LICENSE_INVALID:-10020,DBR_PDF_READ_FAILED:-10021,DBR_PDF_DLL_MISSING:-10022,DBR_PAGE_NUMBER_INVALID:-10023,DBR_CUSTOM_SIZE_INVALID:-10024,DBR_CUSTOM_MODULESIZE_INVALID:-10025,
DBR_RECOGNITION_TIMEOUT:-10026,DBR_JSON_PARSE_FAILED:-10030,DBR_JSON_TYPE_INVALID:-10031,DBR_JSON_KEY_INVALID:-10032,DBR_JSON_VALUE_INVALID:-10033,DBR_JSON_NAME_KEY_MISSING:-10034,DBR_JSON_NAME_VALUE_DUPLICATED:-10035,DBR_TEMPLATE_NAME_INVALID:-10036,DBR_JSON_NAME_REFERENCE_INVALID:-10037,DBR_PARAMETER_VALUE_INVALID:-10038,DBR_DOMAIN_NOT_MATCHED:-10039,DBR_RESERVEDINFO_NOT_MATCHED:-10040,DBR_DBRERR_AZTEC_LICENSE_INVALID:-10041};c.EnumImagePixelFormat={IPF_Binary:0,IPF_BinaryInverted:1,IPF_GrayScaled:2,
IPF_NV21:3,IPF_RGB_565:4,IPF_RGB_555:5,IPF_RGB_888:6,IPF_ARGB_8888:7,IPF_RGB_161616:8,IPF_ARGB_16161616:9};c.EnumResultType={EDT_StandardText:0,EDT_RawText:1,EDT_CandidateText:2,EDT_PartialText:3};c.EnumTerminatePhase={TP_REGION_PREDETECTED:1,TP_IMAGE_PREPROCESSED:2,TP_IMAGE_BINARIZED:4,TP_BARCODE_LOCALIZED:8,TP_BARCODE_TYPE_DETERMINED:16,TP_BARCODE_RECOGNIZED:32};c.EnumConflictMode={ECM_Ignore:1,ECM_Overwrite:2};c.EnumLocalizationMode={LM_SKIP:0,LM_AUTO:1,LM_CONNECTED_BLOCKS:2,LM_STATISTICS:4,LM_LINES:8,
LM_SCAN_DIRECTLY:16,LM_STATISTICS_MARKS:32};c.BarcodeReaderException=function(){return function(a,b){var f=c.EnumErrorCode.DBR_UNKNOWN;"number"==typeof a?(f=a,a=Error(b)):a=Error(a);a.code=f;return a}}();return c}();a.BarcodeReader=a;!x||a._bCustomWorker||v.onmessage||function(){var b=v;a._onLog=a._onLog||function(c){if(b.onmessage!=a._onWorkerMessage)a._onLog=void 0;else{var d=void 0;if(void 0===c)d="undefined";else{try{d=JSON.stringify(c,function(){var a=[],b=[];return function(c,e){if("object"===
typeof e&&null!==e){var f=a.indexOf(e);if(-1!==f)return"[Circular "+b[f]+"]";a.push(e);b.push(c||"root")}return e}}())}catch(n){}if(void 0===d||"{}"===d)d=c.toString()}try{postMessage({type:"log",message:d})}catch(n){b.console&&console.error(message)}}};a._onLog("have detected in worker: "+a.version);var c={};b.onmessage=a._onWorkerMessage=function(d){d=d.data;switch(d.type){case "loadWorker":(function(){a._licenseUrls=d._licenseUrls;a.productKeys=d.productKeys;a._resourcesPath=d._resourcesPath;a._wasmjsResourcePath=
d._wasmjsResourcePath;a._wasmResourcePath=d._wasmResourcePath;a._bUseIndexDB=d._bUseIndexDB;if(d._bDebuggerInWorker)debugger;a._bWasmRuntimeLicenseDebug=d._bWasmRuntimeLicenseDebug;b.__dbrOrigin=d.origin;a.loadWasm().then(function(){postMessage({type:"load",success:!0,version:a.version,_defaultRuntimeSettings:a._defaultRuntimeSettings})},function(a){postMessage({type:"load",success:!1,exception:a.message||a})})})();break;case "createInstance":(function(){try{var b=Math.random();c[b]=new a(d.productKeys);
postMessage({type:"task",id:d.id,body:{success:!0,instanceID:b}})}catch(n){postMessage({type:"task",id:d.id,body:{success:!1,exception:n.message||n}})}})();break;case "deleteInstance":try{c[d.instanceID].deleteInstance(),c[d.instanceID]=void 0,postMessage({type:"task",id:d.id,body:{success:!0}})}catch(g){postMessage({type:"task",id:d.id,body:{success:!1,exception:g.message||g}})}break;case "decodeRawImageUint8Array":(function(){try{a._isShowRelDecodeTimeInResults=d._isShowRelDecodeTimeInResults;var b=
d.body;c[d.instanceID]._decodeRawImageUint8Array(b.buffer,b.width,b.height,b.stride,b.enumImagePixelFormat,b.config).then(function(a){postMessage({type:"task",id:d.id,body:{success:!0,results:a}})}).catch(function(a){postMessage({type:"task",id:d.id,body:{success:!1,exception:a.message||a}})})}catch(n){postMessage({type:"task",id:d.id,body:{success:!1,exception:n.message||n}})}})();break;case "getRuntimeSettings":(function(){try{var a=c[d.instanceID].getRuntimeSettings();postMessage({type:"task",
id:d.id,body:{success:!0,settings:a}})}catch(n){postMessage({type:"task",id:d.id,body:{success:!1,exception:n.message||n}})}})();break;case "updateRuntimeSettings":try{c[d.instanceID].updateRuntimeSettings(d.body.settings),postMessage({type:"task",id:d.id,body:{success:!0}})}catch(g){postMessage({type:"task",id:d.id,body:{success:!1,exception:g.message||g}})}break;case "resetRuntimeSettings":try{c[d.instanceID].resetRuntimeSettings(),postMessage({type:"task",id:d.id,body:{success:!0}})}catch(g){postMessage({type:"task",
id:d.id,body:{success:!1,exception:g.message||g}})}break;case "clearCache":try{a.clearCache(),postMessage({type:"task",id:d.id,body:{success:!0}})}catch(g){postMessage({type:"task",id:d.id,body:{success:!1,exception:g.message||g}})}break;default:postMessage({type:"task",id:d.id,body:{success:!1,exception:"No such task."}})}}}();(function(){var b=v;a.loadWasm=function(){return new Promise(function(e,f){if("loaded"==a._loadWasmStatus)return e();a._loadWasmTaskQueue.push(function(g){if("loaded"==a._loadWasmStatus)return a._loadWasmTaskQueue.next(),
e();if(g)return a._loadWasmTaskQueue.next(),f(a._loadWasmStatus);a._loadWasmStatus="loading";return(new Promise(function(f,e){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm hasn't finish loading.");};if(!b.WebAssembly||"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&/\(.+\s11_2_([2-6]).*\)/.test(navigator.userAgent))throw Error("'Constructor BarcodeReader(productKeys)': The browser doesn't support Webassembly.");
if(p)return a._loadWorker().then(function(){return f()},function(b){a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm load failed. ex: "+(b.message||b));};return e(b)});var g={locateFile:function(){var b=a._wasmName;if(a._wasmResourcePath||a._resourcesPath){var c=a._wasmResourcePath||a._resourcesPath;"/"!=c.charAt(c.length-1)&&(c+="/");b=c+b}else w&&(b=require("path").join(__dirname,b));return b},onRuntimeInitialized:function(){a._BarcodeReaderWasm=g.BarcodeReaderWasm;
var b=new g.BarcodeReaderWasm("");a.version=b.GetVersion()+"(JS "+a._jsVersion+"."+a._jsEditVersion+")";a._defaultRuntimeSettings=JSON.stringify(a._handleRetJsonString(b.GetRuntimeSettings()));b.delete();a._onLog&&a._onLog("load dbr wasm success, version: "+a.version);w?f():d.then(function(){f()},function(a){e(a)})}};g.onExit=g.onAbort=function(b){a._onLog&&a._onLog(b);a._BarcodeReaderWasm=function(){throw Error("'Constructor BarcodeReader(productKeys)': The wasm load failed. Error: "+(b.message||
b));};e(b)};g.print=function(b){a._onLog&&a._onLog(b)};if("undefined"==typeof _dbrLoadWasm){void 0==a._bWithio&&(a._bWithio=w||x&&(a._bCustomWorker||b.onmessage!=a._onWorkerMessage));a._wasmjsName=a._wasmjsName||"dbr-"+a._jsVersion+".wasm"+(a._bWithio?".withio":"")+".min.js";a._wasmName=a._wasmName||"dbr-"+a._jsVersion+(a._bWithio?".withio":"")+".wasm";var k=a._wasmjsName;if(a._wasmjsResourcePath||a._resourcesPath){var l=a._wasmjsResourcePath||a._resourcesPath;"/"!=l.charAt(l.length-1)&&(l+="/");
k=l+k}else w&&(k=require("path").join(__dirname,k));x?importScripts(k):_dbrLoadWasm=require(k)}_dbrLoadWasm(g,c,a)})).then(function(){a._loadWasmStatus="loaded";a._loadWasmTaskQueue.next();e()}).catch(function(b){a._loadWasmStatus=b;a._loadWasmTaskQueue.next();f(b)})},null,["loading"==a._loadWasmStatus])})};a._loadWasmTaskQueue=function(){var a=new t;a.timeout=0;return a}();a._openDb=function(){var a=this;return new Promise(function(b,c){var f=function(){d.result.createObjectStore("info");d.result.createObjectStore("wasm");
d.result.createObjectStore("license");d.result.createObjectStore("consume")},e="open db ["+a._dbName+"] fail",d=indexedDB.open(a._dbName,1);d.onupgradeneeded=f;d.onsuccess=function(){a._DB=d.result;b(d.result)};d.onerror=function(){var g=d.error.message||d.error;-1!=g.indexOf("version")?(d=indexedDB.deleteDatabase(a._dbName),d.onsuccess=function(){var d=indexedDB.open(a._dbName,1);d.onupgradeneeded=f;d.onsuccess=function(){a._DB=d.result;b(d.result)};d.onerror=function(){c(e)}},d.onerror=function(){c(e)}):
c(e+": "+g)}})};a._lookupInDatabase=function(a,b,c){return new Promise(function(f,d){var e=a.transaction([b]).objectStore(b),g=c?e.get(c):e.getAll();g.onsuccess=function(){g.result?f(g.result):d(c+" was not found in "+b)}})};a._storeInDatabase=function(a,b,c,d){return new Promise(function(f,e){var g=a.transaction([b],"readwrite").objectStore(b).put(d,c);g.onerror=function(){e("Failed to store "+c+" in indexDB: "+(g.error.message||g.error))};g.onsuccess=function(){f("Successfully stored "+c+" in "+
b)}})};a._deleteInDatabase=function(a,b,c){return new Promise(function(f,d){var e=a.transaction([b],"readwrite").objectStore(b),g=c?e.delete(c):e.clear();g.onerror=function(){d("Failed to delete "+c+" in indexDB: "+(g.error.message||g.error))};g.onsuccess=function(){f("Successfully delete "+c+" in "+b)}})};var c=function(b,c,l){a._onLog&&a._onLog("start handle dbr wasm, version: "+b);var f=(new Date).getTime();if(w)return new Promise(function(b,d){require("fs").readFile(c,function(c,e){if(c)return d(c);
var g=(new Date).getTime();b(WebAssembly.instantiate(e,l).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-g));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(b)}))})});var e=function(a){return new Promise(function(b,c){var f=a.transaction(["info"]).objectStore("info").get("bSupportStoreModuleInDb"),d=function(){var f=a.transaction(["info"],"readwrite").objectStore("info"),d=new Uint8Array([0,
97,115,109,1,0,0,0,1,5,1,96,0,1,127,3,2,1,0,7,6,1,2,95,97,0,0,10,6,1,4,0,65,1,11]);try{var e=f.put(new WebAssembly.Module(d.buffer),"testStoreModule");e.onsuccess=function(){f.put(!0,"bSupportStoreModuleInDb").onsuccess=function(){b("set bSupportStoreModuleInDb = true success")}};e.onerror=function(){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+(e.error.message||e.error))}}catch(y){c("Failed to store [testStoreModule] in wasm cache, bSupportStoreModuleInDb == false: "+
(y.message||y))}};f.onsuccess=function(){f.result?b("bSupportStoreModuleInDb == true"):d()}})};return(a._bUseIndexDB?a._openDb():Promise.reject("bUseIndexDB false")).then(function(b){a._onLog&&a._onLog("open db success");d=g();return e(b).then(function(b){a._onLog&&a._onLog(b);return Promise.resolve(!0)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.resolve(!1)}).then(function(d){var e=(new Date).getTime();return a._lookupInDatabase(b,"wasm",a._wasmName).then(function(c){if(c instanceof
WebAssembly.Module){a._onLog&&a._onLog("get a wasm module from db, timecost:"+((new Date).getTime()-e));var g=(new Date).getTime();return WebAssembly.instantiate(c,l).then(function(b){a._onLog&&a._onLog("build instance from module timecost: "+((new Date).getTime()-g));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve({module:c,instance:b})})}a._onLog&&a._onLog("get a wasm binary from db, timecost:"+((new Date).getTime()-e));var h=(new Date).getTime();
return WebAssembly.instantiate(c,l).then(function(c){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-h));if(d){var e=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-e));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(c)})}a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-
f));return Promise.resolve(c)})},function(e){a._onLog&&a._onLog(e.message||e);a._onLog&&a._onLog("downloading...");var g=(new Date).getTime();return d?WebAssembly.instantiateStreaming(fetch(c),l).then(function(c){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("download with build timecost: "+((new Date).getTime()-g));var d=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,c.module).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-d));a._onLog&&
a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}):fetch(c).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(c){a._onLog&&a._onLog("download timecost: "+((new Date).getTime()-g));a._onWasmDownloaded&&a._onWasmDownloaded();var f=(new Date).getTime();return a._storeInDatabase(b,"wasm",a._wasmName,
c).then(function(b){a._onLog&&a._onLog(b+", timecost: "+((new Date).getTime()-f));return Promise.resolve(c)},function(b){a._onLog&&a._onLog(b.message||b);return Promise.reject("Can't store wasm in db.")})}).then(function(b){var c=(new Date).getTime();return WebAssembly.instantiate(b,l).then(function(b){a._onLog&&a._onLog("build instance from binary timecost: "+((new Date).getTime()-c));a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(b)})})})})},
function(b){a._onLog&&a._onLog(b.message||b);d=g();return WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(fetch(c),l).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(b)}):fetch(c).then(function(a){if(a.ok)return a.arrayBuffer();throw Error("Network error during fetch wasm.");}).then(function(b){a._onWasmDownloaded&&a._onWasmDownloaded();return WebAssembly.instantiate(b,
l).then(function(b){a._onLog&&a._onLog("finish handle dbr wasm, total timecost: "+((new Date).getTime()-f));return Promise.resolve(b)})})})},d,g=function(){var c=a.productKeys,f=(new Date).getTime();if(!c||8!=c.length)return Promise.resolve(!1);var d=null,g=!1;return a._lookupInDatabase(a._DB,"license",c).then(function(a){d=a;g=d["next-expire-time"]<f},function(){g=!0}).then(function(){a._onLog&&a._onLog("licenseResponseFromDB:");a._onLog&&a._onLog(d);a._onLog&&a._onLog("bNeedGetFromServer: "+g);
if(g){var b=0,e=function(){return fetch(a._licenseUrls[b]+(d?"Cache":"")+"?key="+c+"&version=1"+(d?"&uuid="+d.uuid:"")).then(function(a){if(a.ok)return a.text();throw Error("Network Error: fetch licenseinfo.");}).catch(function(c){if(++b<a._licenseUrls.length)return e();throw c;})};return e().then(function(b){b=JSON.parse(atob(b));a._onLog&&a._onLog("licenseResponseFromServer:");a._onLog&&a._onLog(b);if("ok"==b.status)return a._runtimeLicenseResponse=b,b["next-expire-time"]=f+1E3*b["min-expire-during"],
b["max-expire-time"]=f+1E3*b["max-expire-during"],a._storeInDatabase(a._DB,"license",c,b).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+(b.message||b))});if("error"==b.status)throw Error(b.message);if("exceeded"==b.status)throw Error("Authorized Scan Count Reached.");throw Error("Unknow Response: fetch licenseinfo.");}).catch(function(b){a._onLog&&a._onLog(b.message||b);if(d&&d["max-expire-time"]>f)return d["next-expire-time"]=f+1E3*d["check-interval-after-expire"],a._runtimeLicenseResponse=
d,a._storeInDatabase(a._DB,"license",c,d).catch(function(b){a._onLog&&a._onLog("store update to db fail:"+(b.message||b))});throw Error("Can't get valid licenseinfo from runtimekey. Message: "+b.message);})}return a._runtimeLicenseResponse=d}).then(function(){return a._lookupInDatabase(a._DB,"consume").then(function(c){c.length&&(a._deleteInDatabase(a._DB,"consume"),b._dbrConsume(c))},function(){})})};a.clearCache=function(){return new Promise(function(b,c){if(p){var d=Math.random();a._workerCallbackDic[d]=
function(a){return a.success?b():c(a.exception)};a._dbrWorker.postMessage({type:"clearCache",id:d})}else x&&a._deleteInDatabase(a._DB,"wasm").then(function(){return a._deleteInDatabase(a._DB,"license")}).then(function(){return a._deleteInDatabase(a._DB,"info")}).then(function(){b()},function(a){c(a)})})};var n=!0;b._dbrConsume=function(b){a._onLog&&a._onLog(b);var c=b instanceof Array?b:[b],d=function(){for(var b=0;b<c.length;++b)a._storeInDatabase(a._DB,"consume",Math.random().toString(),c[b]).catch(function(b){a._onLog&&
a._onLog(b)})};if(n){n=!1;var e=a._runtimeLicenseResponse["post-urls"],g=[];for(b=0;b<c.length;++b)g.push(encodeURIComponent(c[b]));var m=function(){return fetch(e[a._indexPostUrl],{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",body:"data="+JSON.stringify(g),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){if(!a.ok)throw Error("consume status: "+a.status);}).catch(function(b){a._onLog&&a._onLog(""+(b.message||b));if(++a._indexPostUrl<e.length)return m();
a._indexPostUrl=0;d()})};return m()}d()}})();if(p){var F=v;a.Scanner=function(a){a=a||{};var b;(b=a.UIElement||a.htmlElement)||(b=document.createElement("div"),b.style.width="100%",b.style.minWidth="100px",b.style.height="100%",b.style.minHeight="100px",b.style.left="0",b.style.top="0",b.style.background="#eee",b.style.display="none",b.innerHTML='<p style="width:100%;height:32px;line-height:32px;position:absolute;margin:auto 0;top:0;bottom:0;text-align:center;">loading</p><video class="dbrScanner-video" playsinline="true" style="width:100%;height:100%;position:absolute;left:0;top:0;"></video><canvas class="dbrScanner-cvs-draw-area" style="width:100%;height:100%;position:absolute;left:0;top:0;"></canvas><select class="dbrScanner-sel-camera" style="position:absolute;left:0;top:0;"></select><select class="dbrScanner-sel-resolution" style="position:absolute;left:0;top:20px;"></select><button class="dbrScanner-btn-close" style="position:absolute;right:0;top:0;"><svg width="16" height="16" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button>');
this.UIElement=b;this.videoSettings=a.videoSettings||{video:{}};b=this.videoSettings.video;b.width||b.height||(b.width={ideal:1280},b.height={ideal:720});b.deviceId||b.facingMode||(b.facingMode={ideal:"environment"});this.intervalTime=a.intervalTime;void 0==this.intervalTime&&(this.intervalTime=100);this.runtimeSettings=a.runtimeSettings;this.searchRegion=a.searchRegion||{sx:void 0,sy:void 0,sWidth:void 0,sHeight:void 0,dWidth:void 0,dHeight:void 0};this.bAddOriVideoCanvasToResult=a.bAddOriVideoCanvasToResult;
this.bAddSearchRegionCanvasToResult=a.bAddSearchRegionCanvasToResult;this.onFrameRead=a.onFrameRead;this.duplicateForgetTime=a.duplicateForgetTime;void 0==this.duplicateForgetTime&&(this.duplicateForgetTime=3E3);this.onUnduplicatedRead=a.onUnduplicatedRead||a.onNewCodeRead;this.barcodeReader=null;this._isOpen=!1;this._lastDeviceId=void 0;this.arrDiffCodeInfo=[];this._intervalDetectVideoPause=1E3;this._bTryTakePhoto=a._bTryTakePhoto;this._photoSettings=a._photoSettings||{};this._imageCapture=this._advancedVideoSettings=
null;this._videoOrientation=void 0;this._videoTrack=this._btnClose=this._optGotRsl=this._selRsl=this._selCam=this._cvsDrawArea=this._video=this._videoCapabilities=null;this._frameCount=0;this._1DRememberFrameCount=5;this._1DTrustFrameCount=2};a.Scanner.loadWasm=a.loadWasm;a.Scanner.isLoaded=function(){return a.isLoaded()};a.Scanner.createInstance=function(b){return a.createInstance().then(function(c){var d=b instanceof a.Scanner?b:new a.Scanner(b);d.barcodeReader=c;var g=c.getRuntimeSettings();g.localizationModes=
[2,0,0,0,0,0,0,0];g.deblurLevel=2;if(d.runtimeSettings)for(var n in d.runtimeSettings)void 0!=g[n]&&(g[n]=d.runtimeSettings[n]);delete d.runtimeSettings;c.updateRuntimeSettings(g);return d})};a.Scanner.prototype.getUIElement=function(){return this.UIElement};a.Scanner.prototype.setUIElement=function(a){this.UIElement=a};a.Scanner.prototype.destroy=a.Scanner.prototype.deleteInstance=function(){this.barcodeReader&&this.barcodeReader.deleteInstance()};a.Scanner.prototype.getScanSettings=function(){return{duplicateForgetTime:this.duplicateForgetTime,
intervalTime:this.intervalTime}};a.Scanner.prototype.updateScanSettings=a.Scanner.prototype.setScanSettings=function(a){this.duplicateForgetTime=a.duplicateForgetTime;this.intervalTime=a.intervalTime};a.Scanner.prototype.getRuntimeSettings=function(){return this.barcodeReader.getRuntimeSettings()};a.Scanner.prototype.updateRuntimeSettings=function(a){return this.barcodeReader.updateRuntimeSettings(a)};a.Scanner.prototype.resetRuntimeSettings=function(){this.barcodeReader.resetRuntimeSettings()};a.Scanner.prototype._bindUI=
function(){for(var a=[this.UIElement],c=$jscomp.makeIterator(this.UIElement.children),d=c.next();!d.done;d=c.next())a.push(d.value);for(c=0;c<a.length;++c){var g=$jscomp.makeIterator(a[c].children);for(d=g.next();!d.done;d=g.next())a.push(d.value)}a=$jscomp.makeIterator(a);for(d=a.next();!d.done;d=a.next())d=d.value,!this._video&&d.classList.contains("dbrScanner-video")?this._video=d:!this._cvsDrawArea&&d.classList.contains("dbrScanner-cvs-drawArea")?this._cvsDrawArea=d:!this._selCam&&d.classList.contains("dbrScanner-sel-camera")?
this._selCam=d:!this._selRsl&&d.classList.contains("dbrScanner-sel-resolution")?(this._selRsl=d,this._selRsl.options.length||(this._selRsl.innerHTML=[this._optGotRsl?"":'<option class="dbrScanner-opt-gotResolution" value="got"></option>','<option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="2560" data-height="1440">ask 2560 x 1440</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option>'].join(""),
this._optGotRsl=this._optGotRsl||this._selRsl.options[0])):!this._optGotRsl&&d.classList.contains("dbrScanner-opt-gotResolution")?this._optGotRsl=d:!this._btnClose&&d.classList.contains("dbrScanner-btn-close")&&(this._btnClose=d);if(!this._video)throw this._unBindUI(),Error("Can not find HTMLVideoElement with class `dbrScanner-video`.");};a.Scanner.prototype._unBindUI=function(){this._btnClose=this._optGotRsl=this._selRsl=this._selCam=this._cvsDrawArea=this._video=null};a.Scanner.prototype.getVideoSettings=
function(){return JSON.parse(JSON.stringify(this.videoSettings))};a.Scanner.prototype.updateVideoSettings=function(a){this.videoSettings=JSON.parse(JSON.stringify(a));return this._isOpen?this.play():Promise.resolve()};a.Scanner.prototype.isOpen=function(){return this._isOpen};a.Scanner.prototype.show=a.Scanner.prototype.open=function(){var b=this;if(!navigator.mediaDevices)return Promise.reject("`navigator.mediaDevices` is not available. Please ensure that you host the site in https.");if(this._isOpen)return Promise.reject("The scanner is already open.");
this._isOpen=!0;this.arrDiffCodeInfo=[];this._frameCount=0;this._lastDeviceId=void 0;try{this._bindUI()}catch(k){return Promise.reject(k)}var c=function(){b.play(b._selCam.value).then(function(){b._isOpen||b.stop()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};this._selCam&&this._selCam.addEventListener("change",c);var d=function(){if(b._selRsl&&-1!=b._selRsl.selectedIndex){var a=b._selRsl.options[b._selRsl.selectedIndex];var c=a.getAttribute("data-width");a=a.getAttribute("data-height")}b.play(void 0,
c,a).then(function(){b._isOpen||b.stop()}).catch(function(a){alert("Play video failed: "+(a.message||a))})};this._selRsl&&this._selRsl.addEventListener("change",d);var g=this._closeWindow=function(){b.stop();b._isOpen=!1;b._selCam&&b._selCam.removeEventListener("change",c);b._selRsl&&b._selRsl.removeEventListener("change",d);b._closeWindow=void 0;b._btnClose&&b._btnClose.removeEventListener("click",g);b.UIElement.style.display="none"};this._btnClose&&this._btnClose.addEventListener("click",g);this.UIElement.parentNode||
(this.UIElement.style.position||(this.UIElement.style.position="fixed"),document.body.appendChild(this.UIElement));"none"==this.UIElement.style.display&&(this.UIElement.style.display="");var n,e,f=this.play().then(function(a){n=a;return b.updateDevice()}).then(function(a){e=a;return Promise.resolve()});var l=b.barcodeReader?Promise.resolve():a.Scanner.createInstance(b);return Promise.all([f,l]).then(function(){if(!b._isOpen)return b.stop();b._loopReadVideo();return Promise.resolve({width:n.width,
height:n.height,current:e.current,all:e.all})})};a.Scanner.prototype.play=function(b,c,d){var g=this;return this._isOpen?new Promise(function(n,e){g.stop();a._onLog&&a._onLog("======before video========");var f=g.videoSettings;if(/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent))1280<=c?f.video.width=1280:640<=c?f.video.width=640:320<=c&&(f.video.width=320);else if(c||d)c&&(f.video.width={ideal:c}),d&&(f.video.height={ideal:d});b?(delete f.video.facingMode,
f.video.deviceId={exact:b},g._lastDeviceId=b):!f.video.deviceId&&g._lastDeviceId&&(delete f.video.facingMode,f.video.deviceId={ideal:g._lastDeviceId});var l=!1,k=function(){a._onLog&&a._onLog("======try getUserMedia========");a._onLog&&a._onLog("ask "+JSON.stringify(f.video.width)+"x"+JSON.stringify(f.video.height));navigator.mediaDevices.getUserMedia(f).then(function(b){a._onLog&&a._onLog("======get video========");return new Promise(function(c,d){var f=b.getVideoTracks();f.length&&(g._videoTrack=
f[0],F.ImageCapture&&(g._imageCapture=new ImageCapture(g._videoTrack)));g._video.srcObject=b;g._video.onloadedmetadata=function(){a._onLog&&a._onLog("======play video========");g._video.play().then(function(){a._onLog&&a._onLog("======played video========");g._videoTrack.applyConstraints&&g._videoTrack.getCapabilities&&(g._videoCapabilities=g._videoTrack.getCapabilities(),g._advancedVideoSettings={});var b="got "+g._video.videoWidth+"x"+g._video.videoHeight;g._optGotRsl&&(g._optGotRsl.setAttribute("data-width",
g._video.videoWidth),g._optGotRsl.setAttribute("data-height",g._video.videoHeight),g._optGotRsl.innerText=b,g._selRsl&&g._optGotRsl.parentNode==g._selRsl&&(g._selRsl.value="got"));a._onLog&&a._onLog(b);c();n({width:g._video.videoWidth,height:g._video.videoHeight})},function(a){d(a)})};g._video.onerror=function(){d()}})}).catch(function(b){a._onLog&&a._onLog(b);!l&&f.video?(l=!0,f.video.width=void 0,f.video.height=void 0,k()):e(b)})};k()}):Promise.reject("The scanner is not open.")};a.Scanner.prototype.pause=
function(){this._video&&this._video.pause()};a.Scanner.prototype.stop=function(){this._video&&this._video.srcObject&&(a._onLog&&a._onLog("======stop video========"),this._video.srcObject.getTracks().forEach(function(a){a.stop()}),this._videoOrientation=this._videoTrack=this._video.srcObject=null)};a.Scanner.prototype.hide=a.Scanner.prototype.close=function(){this._isOpen&&this._closeWindow()};a.Scanner.prototype.getCurrentCamera=function(){return this.updateDevice().then(function(a){return a.current})};
a.Scanner.prototype.getAllCameras=function(){return this.updateDevice().then(function(a){return a.all})};a.Scanner.prototype.setCurrentCamera=function(a){return this.play(a.deviceId||a)};a.Scanner.prototype.updateDevice=function(){var a=this;return navigator.mediaDevices.enumerateDevices().then(function(b){var c=[],g;if(a._selCam){var n=a._selCam.value;a._selCam.innerHTML=""}for(var e=0;e<b.length;++e){var f=b[e];if("videoinput"==f.kind){var l={};l.deviceId=f.deviceId;l.label=f.label||"camera "+e;
c.push(l)}}b=void 0;if(a._video)for(e=$jscomp.makeIterator(a._video.srcObject.getVideoTracks()),f=e.next();!f.done;f=e.next()){f=f.value;if(b)break;l=$jscomp.makeIterator(c);for(var k=l.next();!k.done;k=l.next())if(k=k.value,f.label==k.label){b=k;a._lastDeviceId=k.deviceId;break}}if(a._selCam){e=$jscomp.makeIterator(c);for(k=e.next();!k.done;k=e.next())f=k.value,l=document.createElement("option"),l.value=f.deviceId,l.innerText=f.label,a._selCam.appendChild(l),n==f.deviceId&&(g=l);n=a._selCam.childNodes;
if(!g&&b&&n.length)for(n=$jscomp.makeIterator(n),e=n.next();!e.done;e=n.next())if(e=e.value,b.label==e.innerText){g=e;break}g&&(a._selCam.value=g.value)}return Promise.resolve({current:b,all:c})})};a.Scanner.prototype.getResolution=function(){return this._isOpen?[this._video.videoWidth,this._video.videoHeight]:null};a.Scanner.prototype.setResolution=function(a,c){return this._isOpen?(a instanceof Array&&(a=a[0],c=a[1]),this.play(null,a,c)):Promise.reject()};a.Scanner.prototype.getCompatibility=function(){return{torch:this._videoCapabilities?
this._videoCapabilities.torch||!1:!1,focus:!1}};a.Scanner.prototype.turnOnTorch=function(){return this.getCompatibility().torch?(this._advancedVideoSettings.torch=!0,this._videoTrack.applyConstraints({advanced:[this._advancedVideoSettings]})):Promise.reject("Not support or camera not open.")};a.Scanner.prototype.turnOffTorch=function(){return this.getCompatibility().torch?(this._advancedVideoSettings.torch=!1,this._videoTrack.applyConstraints({advanced:[this._advancedVideoSettings]})):Promise.reject("Not support or camera not open.")};
a.Scanner.prototype._cloneDecodeResults=function(a,c){if(a instanceof Array){var b=[];a=$jscomp.makeIterator(a);for(var g=a.next();!g.done;g=a.next())b.push(this._cloneDecodeResults(g.value,c));return b}b=JSON.parse(JSON.stringify(a,function(a,b){if("oriVideoCanvas"!=a&&"searchRegionCanvas"!=a)return b}));c||(b.oriVideoCanvas=a.oriVideoCanvas,b.searchRegionCanvas=a.searchRegionCanvas);return b};a.Scanner.prototype._loopReadVideo=function(){var b=this;if(this._isOpen)if(this._video.paused)a._onLog&&
a._onLog("Video is paused. Ask in 1s."),setTimeout(function(){b._loopReadVideo()},this._intervalDetectVideoPause);else{a._onLog&&a._onLog("======= once read =======");var c=(new Date).getTime();(function(){var a=JSON.parse(JSON.stringify(b.searchRegion));a.bAddOriVideoCanvasToResult=b.bAddOriVideoCanvasToResult;a.bAddSearchRegionCanvasToResult=b.bAddSearchRegionCanvasToResult;return!b._bTryTakePhoto||!b._imageCapture||b._advancedVideoSettings&&b._advancedVideoSettings.torch||"live"!=b._videoTrack.readyState||
!b._videoTrack.enabled||b._videoTrack.muted?b.barcodeReader.decodeVideo.apply(b.barcodeReader,[b._video,a]):b._imageCapture.takePhoto(b._photoSettings).then(function(c){a.videoWidth=b._video.videoWidth;a.videoHeight=b._video.videoHeight;return b._videoOrientation||"image/jpeg"!=c.type?c:new Promise(function(a){C.getData(c,function(){b._videoOrientation=C.getTag(this,"Orientation");a(c)})})}).then(function(c){a._videoOrientation=b._videoOrientation;return b.barcodeReader._decodeBlob(c,a)})})().then(function(d){var g=
(new Date).getTime();a._onLog&&a._onLog("time cost: "+(g-c)+"ms");++b._frameCount;a._onLog&&a._onLog(d);for(var n=[],e=$jscomp.makeIterator(d),f=e.next();!f.done;f=e.next()){f=f.value;for(var l=!1,k=0;k<b.arrDiffCodeInfo.length;++k){var p=b.arrDiffCodeInfo[k];if(p.result.BarcodeText==f.BarcodeText&&p.result.BarcodeFormat==f.BarcodeFormat){p.time=g;p.result=b._cloneDecodeResults(f,!0);++p.count;l=!0;0!=(f.BarcodeFormat&a.EnumBarcodeFormat.OneD)&&(k=p.frameCounts,k.push(b._frameCount),k.length==b._1DTrustFrameCount?
n.push(f):k.length>b._1DTrustFrameCount&&k.shift());break}}l||(b.arrDiffCodeInfo.push({result:b._cloneDecodeResults(f,!0),time:g,count:1}),0==(f.BarcodeFormat&a.EnumBarcodeFormat.OneD)?n.push(f):b.arrDiffCodeInfo[b.arrDiffCodeInfo.length-1].frameCounts=[b._frameCount])}for(e=0;e<b.arrDiffCodeInfo.length;++e)f=b.arrDiffCodeInfo[e],f.time+b.duplicateForgetTime<g&&(0==(f.result.BarcodeFormat&a.EnumBarcodeFormat.OneD)?b.arrDiffCodeInfo.splice(e,1):(f=f.frameCounts,b._frameCount-f[f.length-1]>=b._1DRememberFrameCount&&
b.arrDiffCodeInfo.splice(e,1)));if(b.onFrameRead)b.onFrameRead(b._cloneDecodeResults(d));d=$jscomp.makeIterator(n);for(f=d.next();!f.done;f=d.next())if(g=f.value,b.onUnduplicatedRead)b.onUnduplicatedRead(g.BarcodeText,b._cloneDecodeResults(g));setTimeout(function(){b._loopReadVideo()},b.intervalTime)}).catch(function(c){a._onLog&&a._onLog(c.message||c);setTimeout(function(){b._loopReadVideo()},b.intervalTime);if("platform error"!=c.message)throw console.error(c.message),c;})}}}a.BarcodeScanner=a.Scanner;
var C=p?function(){function a(a,b){b||a.match(/^data:([^;]+);base64,/mi);a=a.replace(/^data:([^;]+);base64,/gmi,"");a=atob(a);b=a.length;for(var c=new ArrayBuffer(b),f=new Uint8Array(c),d=0;d<b;d++)f[d]=a.charCodeAt(d);return c}function c(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0);c.responseType="blob";c.onload=function(a){200!=this.status&&0!==this.status||b(this.response)};c.send()}function d(b,d){function e(a){var c=g(a);a:{var e=new DataView(a);if(255!=e.getUint8(0)||216!=e.getUint8(1))e=
!1;else{for(var h=2,q=a.byteLength;h<q;){var r=e,k=h;if(56===r.getUint8(k)&&66===r.getUint8(k+1)&&73===r.getUint8(k+2)&&77===r.getUint8(k+3)&&4===r.getUint8(k+4)&&4===r.getUint8(k+5)){r=e.getUint8(h+7);0!==r%2&&(r+=1);0===r&&(r=4);q=h+8+r;h=e.getUint16(h+6+r);e=q;q=new DataView(a);r={};for(k=e;k<e+h;){if(28===q.getUint8(k)&&2===q.getUint8(k+1)){var l=q.getUint8(k+2);if(l in x){var z=q.getInt16(k+3);l=x[l];z=f(q,k+5,z);r.hasOwnProperty(l)?r[l]instanceof Array?r[l].push(z):r[l]=[r[l],z]:r[l]=z}}k++}e=
r;break a}h++}e=void 0}}a:if("DOMParser"in self)if(h=new DataView(a),255!=h.getUint8(0)||216!=h.getUint8(1))var m=!1;else{q=2;r=a.byteLength;for(a=new DOMParser;q<r-4;)if("http"==f(h,q,4)){r=q-1;q=h.getUint16(q-2)-1;h=f(h,r,q);q=h.indexOf("xmpmeta>")+8;h=h.substring(h.indexOf("<x:xmpmeta"),q);q=h.indexOf("x:xmpmeta")+10;h=h.slice(0,q)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+
h.slice(q);b:{a=a.parseFromString(h,"text/xml");try{h={};if(0<a.children.length)for(q=0;q<a.children.length;q++){var n=a.children.item(q),p=n.attributes,B;for(B in p){var t=p[B],y=t.nodeName,E=t.nodeValue;void 0!==y&&(h[y]=E)}var u=n.nodeName;if("undefined"==typeof h[u])h[u]=xml2json(n);else{if("undefined"==typeof h[u].push){var v=h[u];h[u]=[];h[u].push(v)}h[u].push(xml2json(n))}}else h=a.textContent;m=h;break b}catch(G){console.log(G.message)}m=void 0}break a}else q++;m=void 0}else m=void 0;b.exifdata=
c||{};b.iptcdata=e||{};b.xmpdata=m||{};d&&d.call(b)}if(b.src)if(/^data:/i.test(b.src)){var h=a(b.src);e(h)}else if(/^blob:/i.test(b.src)){var q=new FileReader;q.onload=function(a){e(a.target.result)};c(b.src,function(a){q.readAsArrayBuffer(a)})}else{var k=new XMLHttpRequest;k.onload=function(){if(200==this.status||0===this.status)e(k.response);else throw"Could not load image";k=null};k.open("GET",b.src,!0);k.responseType="arraybuffer";k.send(null)}else self.FileReader&&(b instanceof self.Blob||b instanceof
self.File)&&(q=new FileReader,q.onload=function(a){e(a.target.result)},q.readAsArrayBuffer(b))}function g(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;var c=2;a=a.byteLength;for(var d;c<a;){if(255!=b.getUint8(c))return!1;d=b.getUint8(c+1);if(225==d)return l(b,c+4,b.getUint16(c+2)-2);c+=2+b.getUint16(c+2)}}function n(a,b,c,d,f){var g=a.getUint16(c,!f),h={},q;for(q=0;q<g;q++){var r=c+12*q+2;var k=d[a.getUint16(r,!f)];h[k]=e(a,r,b,c,f)}return h}function e(a,b,c,d,e){var g=
a.getUint16(b+2,!e);d=a.getUint32(b+4,!e);c=a.getUint32(b+8,!e)+c;switch(g){case 1:case 7:if(1==d)return a.getUint8(b+8,!e);c=4<d?c:b+8;b=[];for(g=0;g<d;g++)b[g]=a.getUint8(c+g);return b;case 2:return f(a,4<d?c:b+8,d-1);case 3:if(1==d)return a.getUint16(b+8,!e);c=2<d?c:b+8;b=[];for(g=0;g<d;g++)b[g]=a.getUint16(c+2*g,!e);return b;case 4:if(1==d)return a.getUint32(b+8,!e);b=[];for(g=0;g<d;g++)b[g]=a.getUint32(c+4*g,!e);return b;case 5:if(1==d){var h=a.getUint32(c,!e);var q=a.getUint32(c+4,!e);a=new Number(h/
q);a.numerator=h;a.denominator=q;return a}b=[];for(g=0;g<d;g++)h=a.getUint32(c+8*g,!e),q=a.getUint32(c+4+8*g,!e),b[g]=new Number(h/q),b[g].numerator=h,b[g].denominator=q;return b;case 9:if(1==d)return a.getInt32(b+8,!e);b=[];for(g=0;g<d;g++)b[g]=a.getInt32(c+4*g,!e);return b;case 10:if(1==d)return a.getInt32(c,!e)/a.getInt32(c+4,!e);b=[];for(g=0;g<d;g++)b[g]=a.getInt32(c+8*g,!e)/a.getInt32(c+4+8*g,!e);return b}}function f(a,b,c){for(var d="",e=b;e<b+c;e++)d+=String.fromCharCode(a.getUint8(e));return d}
function l(a,b){if("Exif"!=f(a,b,4))return!1;var c=b+6;if(18761==a.getUint16(c))var d=!1;else if(19789==a.getUint16(c))d=!0;else return!1;if(42!=a.getUint16(c+2,!d))return!1;var e=a.getUint32(c+4,!d);if(8>e)return!1;b=n(a,c,c+e,m,d);if(b.ExifIFDPointer){var g=n(a,c,c+b.ExifIFDPointer,p,d);for(h in g){switch(h){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":g[h]=
v[h][g[h]];break;case "ExifVersion":case "FlashpixVersion":g[h]=String.fromCharCode(g[h][0],g[h][1],g[h][2],g[h][3]);break;case "ComponentsConfiguration":g[h]=v.Components[g[h][0]]+v.Components[g[h][1]]+v.Components[g[h][2]]+v.Components[g[h][3]]}b[h]=g[h]}}if(b.GPSInfoIFDPointer)for(h in g=n(a,c,c+b.GPSInfoIFDPointer,t,d),g){switch(h){case "GPSVersionID":g[h]=g[h][0]+"."+g[h][1]+"."+g[h][2]+"."+g[h][3]}b[h]=g[h]}var h=d;e=c+e;d=a.getUint16(e,!h);if(e=a.getUint32(e+2+12*d,!h))if(e>a.byteLength)a=
{};else{h=n(a,c,c+e,w,h);if(h.Compression)switch(h.Compression){case 6:h.JpegIFOffset&&h.JpegIFByteCount&&(h.blob=new Blob([new Uint8Array(a.buffer,c+h.JpegIFOffset,h.JpegIFByteCount)],{type:"image/jpeg"}));break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",h.Compression)}else 2==h.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");a=h}else a={};b.thumbnail=
a;return b}var k=function(a){if(a instanceof k)return a;if(!(this instanceof k))return new k(a);this.EXIFwrapped=a},p=k.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",
33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",
41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},m=k.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",
34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",
532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},t=k.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",
21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},w=k.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",
296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},v=k.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",
1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",
7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",
3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},x={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};k.getData=
function(a,b){if((self.Image&&a instanceof self.Image||self.HTMLImageElement&&a instanceof self.HTMLImageElement)&&!a.complete)return!1;a.exifdata?b&&b.call(a):d(a,b);return!0};k.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};k.getIptcTag=function(a,b){if(a.exifdata)return a.iptcdata[b]};k.getAllTags=function(a){if(!a.exifdata)return{};var b;a=a.exifdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};k.getAllIptcTags=function(a){if(!a.exifdata)return{};var b;a=a.iptcdata;
var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};k.pretty=function(a){if(!a.exifdata)return"";var b;a=a.exifdata;var c="";for(b in a)a.hasOwnProperty(b)&&(c="object"==typeof a[b]?a[b]instanceof Number?c+(b+" : "+a[b]+" ["+a[b].numerator+"/"+a[b].denominator+"]\r\n"):c+(b+" : ["+a[b].length+" values]\r\n"):c+(b+" : "+a[b]+"\r\n"));return c};k.readFromBinaryFile=function(a){return g(a)};return k}():void 0;return a});
